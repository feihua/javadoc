
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>2.大数据技术之Kafka · 日常笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="liufeihua">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-treeview/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../mongo/" />
    
    
    <link rel="prev" href="shell.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../automation/">
            
                <a href="../../automation/">
            
                    
                    一、互联网专题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../automation/git/">
            
                <a href="../../automation/git/">
            
                    
                    Git版本控制
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../../automation/git/git-base-use.html">
            
                <a href="../../automation/git/git-base-use.html">
            
                    
                    1.Git基本概念与核心命令掌握
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../automation/maven/">
            
                <a href="../../automation/maven/">
            
                    
                    Maven依赖管理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../../automation/maven/maven-base-use.html">
            
                <a href="../../automation/maven/maven-base-use.html">
            
                    
                    1.Maven基本概念与核心配置 
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../automation/jenkins/">
            
                <a href="../../automation/jenkins/">
            
                    
                    Jenkins自动化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../../automation/jenkins/1_JVM整体结构介绍.md">
            
                <span>
            
                    
                    1.JVM整体结构介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../../automation/jenkins/2_JVM性能调优监控工具.md">
            
                <span>
            
                    
                    2.JVM性能调优监控工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../../automation/jenkins/3_JVM垃圾回收与调优.md">
            
                <span>
            
                    
                    3.JVM垃圾回收与调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../automation/k8s/">
            
                <a href="../../automation/k8s/">
            
                    
                    K8s服务编排
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../../automation/k8s/install.html">
            
                <a href="../../automation/k8s/install.html">
            
                    
                    K8s安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1.1" data-path="../../automation/k8s/kubeadm-install-one.html">
            
                <a href="../../automation/k8s/kubeadm-install-one.html">
            
                    
                    1.快速部署一个K8s集群
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.1.2" data-path="../../automation/k8s/kubeadm-install-all.html">
            
                <a href="../../automation/k8s/kubeadm-install-all.html">
            
                    
                    2.搭建高可用的K8s集群
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../../automation/k8s/cmd.html">
            
                <a href="../../automation/k8s/cmd.html">
            
                    
                    1.K8s相关命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../../automation/k8s/Kubernetes-deployment.html">
            
                <a href="../../automation/k8s/Kubernetes-deployment.html">
            
                    
                    2.K8s部署应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../../automation/k8s/Ingress.html">
            
                <a href="../../automation/k8s/Ingress.html">
            
                    
                    3.Ingress暴露容器化应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../source/">
            
                <a href="../../source/">
            
                    
                    二、源码框架专题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../source/mybatis/">
            
                <a href="../../source/mybatis/">
            
                    
                    mybatis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../../source/mybatis/base-use.html">
            
                <a href="../../source/mybatis/base-use.html">
            
                    
                    1.基本使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../../source/mybatis/analysis.html">
            
                <a href="../../source/mybatis/analysis.html">
            
                    
                    2源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../../source/mybatis/realization.html">
            
                <a href="../../source/mybatis/realization.html">
            
                    
                    3.代码实现
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../source/spring/">
            
                <a href="../../source/spring/">
            
                    
                    spring
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../../source/spring/ioc.html">
            
                <a href="../../source/spring/ioc.html">
            
                    
                    1.IOC容器设计理念与源码解读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../../source/spring/aop.html">
            
                <a href="../../source/spring/aop.html">
            
                    
                    2.AOP事物底层原理分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../../source/spring/mvc.html">
            
                <a href="../../source/spring/mvc.html">
            
                    
                    3.Spring mvc原理深度解析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../concurrent/">
            
                <a href="../../concurrent/">
            
                    
                    三、并发编程专题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../concurrent/executor.html">
            
                <a href="../../concurrent/executor.html">
            
                    
                    1.Executor线程池详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../concurrent/JMM&Lock&Tools.html">
            
                <a href="../../concurrent/JMM&Lock&Tools.html">
            
                    
                    2.JMM&Lock&Tools详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../concurrent/atomic&collections.html">
            
                <a href="../../concurrent/atomic&collections.html">
            
                    
                    3.atomic&collections详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../concurrent/Fork-join.html">
            
                <a href="../../concurrent/Fork-join.html">
            
                    
                    4.Fork-join框架原理解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../concurrent/BlockingQueue.html">
            
                <a href="../../concurrent/BlockingQueue.html">
            
                    
                    5.BlockingQueue框架原理解析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../performance/">
            
                <a href="../../performance/">
            
                    
                    四、性能调优专题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../performance/jvm/">
            
                <a href="../../performance/jvm/">
            
                    
                    jvm
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../../performance/jvm/base.html">
            
                <a href="../../performance/jvm/base.html">
            
                    
                    1.JVM整体结构介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../../performance/jvm/view.html">
            
                <a href="../../performance/jvm/view.html">
            
                    
                    2.JVM性能调优监控工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../../performance/jvm/gc.html">
            
                <a href="../../performance/jvm/gc.html">
            
                    
                    3.JVM垃圾回收与调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../performance/mysql/">
            
                <a href="../../performance/mysql/">
            
                    
                    mysql
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../../performance/mysql/use.html">
            
                <a href="../../performance/mysql/use.html">
            
                    
                    1.Mysql安装和使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../../performance/mysql/high-use.html">
            
                <a href="../../performance/mysql/high-use.html">
            
                    
                    2.Mysql性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="../../performance/mysql/mysql-index.html">
            
                <a href="../../performance/mysql/mysql-index.html">
            
                    
                    3.索引底层数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="../../performance/mysql/Explain.html">
            
                <a href="../../performance/mysql/Explain.html">
            
                    
                    1.Explain详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="../../performance/mysql/high-index.html">
            
                <a href="../../performance/mysql/high-index.html">
            
                    
                    2.索引优化深入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="../../performance/mysql/acid.html">
            
                <a href="../../performance/mysql/acid.html">
            
                    
                    3.Mysql锁与事务隔离级别
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../performance/nginx/">
            
                <a href="../../performance/nginx/">
            
                    
                    nginx
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../../performance/nginx/Nginx-config.html">
            
                <a href="../../performance/nginx/Nginx-config.html">
            
                    
                    1.Nginx核心模块与配置实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../../performance/nginx/Nginx-In-actual-combat.html">
            
                <a href="../../performance/nginx/Nginx-In-actual-combat.html">
            
                    
                    2.Nginx 性能优化实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../../performance/tomcat/">
            
                <a href="../../performance/tomcat/">
            
                    
                    tomcat
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="../../performance/tomcat/Tomcat-pro-use.html">
            
                <a href="../../performance/tomcat/Tomcat-pro-use.html">
            
                    
                    1.Tomcat生产环境应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../">
            
                <a href="../">
            
                    
                    五、分布式框架专题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../zookeeper/">
            
                <a href="../zookeeper/">
            
                    
                    zookeeper
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../zookeeper/zookeeper-base-use.html">
            
                <a href="../zookeeper/zookeeper-base-use.html">
            
                    
                    1.特性与节点说明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../zookeeper/zookeeper-client-use.html">
            
                <a href="../zookeeper/zookeeper-client-use.html">
            
                    
                    2.客户端使用与集群特性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="../zookeeper/zookeeper-sence-use.html">
            
                <a href="../zookeeper/zookeeper-sence-use.html">
            
                    
                    3.典型使用场景实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.4" data-path="../zookeeper/zookeeper-zab.html">
            
                <a href="../zookeeper/zookeeper-zab.html">
            
                    
                    4.ZAB协议实现源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../netty/">
            
                <a href="../netty/">
            
                    
                    netty
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="../netty/shell.html">
            
                <a href="../netty/shell.html">
            
                    
                    1.启停脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="../netty/netty.html">
            
                <a href="../netty/netty.html">
            
                    
                    2.分布式之netty
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../dubbo/">
            
                <a href="../dubbo/">
            
                    
                    dubbo
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="../dubbo/dubbo-introduce.html">
            
                <a href="../dubbo/dubbo-introduce.html">
            
                    
                    1.从0到1整体认知分布式系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="../dubbo/dubbo-base-use.html">
            
                <a href="../dubbo/dubbo-base-use.html">
            
                    
                    2.快速掌握Dubbo常规应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3" data-path="../dubbo/dubbo-high-use.html">
            
                <a href="../dubbo/dubbo-high-use.html">
            
                    
                    3.Dubbo企业级应用进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4" data-path="../dubbo/dubbo-module-detail.html">
            
                <a href="../dubbo/dubbo-module-detail.html">
            
                    
                    2.Dubb调用模块详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.5" data-path="../dubbo/dubbo-proto-detail.html">
            
                <a href="../dubbo/dubbo-proto-detail.html">
            
                    
                    3.Dubbo协议模块源码剖析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../rocketmq/">
            
                <a href="../rocketmq/">
            
                    
                    rocketmq
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.1" data-path="../rocketmq/shell.html">
            
                <a href="../rocketmq/shell.html">
            
                    
                    1.启停脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4.2" data-path="../rocketmq/rocketmq.html">
            
                <a href="../rocketmq/rocketmq.html">
            
                    
                    2.分布式之RockeqMq
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../rabbitmq/">
            
                <a href="../rabbitmq/">
            
                    
                    rabbitmq
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.5.1" data-path="../rabbitmq/1_JVM整体结构介绍.md">
            
                <span>
            
                    
                    1.JVM整体结构介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.2" data-path="../rabbitmq/2_JVM性能调优监控工具.md">
            
                <span>
            
                    
                    2.JVM性能调优监控工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.3" data-path="../rabbitmq/3_JVM垃圾回收与调优.md">
            
                <span>
            
                    
                    3.JVM垃圾回收与调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="./">
            
                <a href="./">
            
                    
                    kafka
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.6.1" data-path="shell.html">
            
                <a href="shell.html">
            
                    
                    1.集群启动停止脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.6.2" data-path="kafka.html">
            
                <a href="kafka.html">
            
                    
                    2.大数据技术之Kafka
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../mongo/">
            
                <a href="../mongo/">
            
                    
                    mongo
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.7.1" data-path="../mongo/mongoDb-data.html">
            
                <a href="../mongo/mongoDb-data.html">
            
                    
                    1.准备数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.2" data-path="../mongo/mongoDb-quick-start.html">
            
                <a href="../mongo/mongoDb-quick-start.html">
            
                    
                    2.快速上手
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.3" data-path="../mongo/mongoDb-enterprise.html">
            
                <a href="../mongo/mongoDb-enterprise.html">
            
                    
                    3.企业应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../redis/">
            
                <a href="../redis/">
            
                    
                    redis缓存
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.8.1" data-path="../redis/redis.html">
            
                <a href="../redis/redis.html">
            
                    
                    1.分布式之Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.2" data-path="../redis/redis6.html">
            
                <a href="../redis/redis6.html">
            
                    
                    2.Redis6.0
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../shardingsphere/">
            
                <a href="../shardingsphere/">
            
                    
                    shardingsphere
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.9.1" data-path="../shardingsphere/1_JVM整体结构介绍.md">
            
                <span>
            
                    
                    1.JVM整体结构介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.2" data-path="../shardingsphere/2_JVM性能调优监控工具.md">
            
                <span>
            
                    
                    2.JVM性能调优监控工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.3" data-path="../shardingsphere/3_JVM垃圾回收与调优.md">
            
                <span>
            
                    
                    3.JVM垃圾回收与调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../elk/">
            
                <a href="../elk/">
            
                    
                    elk
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.10.1" data-path="../elk/shell.html">
            
                <a href="../elk/shell.html">
            
                    
                    1.启停脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.2" data-path="../elk/elk.html">
            
                <a href="../elk/elk.html">
            
                    
                    2.分布式之ELK
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../micro/">
            
                <a href="../../micro/">
            
                    
                    六、微服务框架专题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../micro/fast.html">
            
                <a href="../../micro/fast.html">
            
                    
                    1.快速开始
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../micro/tomcat.html">
            
                <a href="../../micro/tomcat.html">
            
                    
                    2.Springboot启动Tomcat热身
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../micro/springboot-auto.html">
            
                <a href="../../micro/springboot-auto.html">
            
                    
                    3.springboot自动装配原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../micro/Springboot-source.html">
            
                <a href="../../micro/Springboot-source.html">
            
                    
                    4.SpringBoot源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../micro/Eureka-source.html">
            
                <a href="../../micro/Eureka-source.html">
            
                    
                    5.Eureka源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../../micro/1_JVM整体结构介绍.md">
            
                <span>
            
                    
                    6.Ribbon&Feign介绍及使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../../micro/2_JVM性能调优监控工具.md">
            
                <span>
            
                    
                    7.Ribbon&Feign源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../../micro/3_JVM垃圾回收与调优.md">
            
                <span>
            
                    
                    8.Hystrix限流降级熔断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../../micro/1_JVM整体结构介绍.md">
            
                <span>
            
                    
                    9.网关zuul
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../../micro/Hystrix-source.html">
            
                <a href="../../micro/Hystrix-source.html">
            
                    
                    10.Hystrix&Zuul源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../../micro/2_JVM性能调优监控工具.md">
            
                <span>
            
                    
                    12.配置中心Config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../../micro/3_JVM垃圾回收与调优.md">
            
                <span>
            
                    
                    13.链路跟踪Sleuth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../../micro/docker.html">
            
                <a href="../../micro/docker.html">
            
                    
                    14.Docker快速入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.14" data-path="../../micro/Docker-Compose.html">
            
                <a href="../../micro/Docker-Compose.html">
            
                    
                    15.DockerCompose微服务编排
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15" data-path="../../micro/SpringCloudDocker.html">
            
                <a href="../../micro/SpringCloudDocker.html">
            
                    
                    16.Docker整体编排SpringCloud
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../project/">
            
                <a href="../../project/">
            
                    
                    七、项目实战专题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../project/SystemArchitecture.html">
            
                <a href="../../project/SystemArchitecture.html">
            
                    
                    1.系统架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../project/member.html">
            
                <a href="../../project/member.html">
            
                    
                    2.商品&会员模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../project/order.html">
            
                <a href="../../project/order.html">
            
                    
                    3.交易&营销模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../project/pay.html">
            
                <a href="../../project/pay.html">
            
                    
                    4.支付模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../project/Depots-table-1.html">
            
                <a href="../../project/Depots-table-1.html">
            
                    
                    5.分库分表一
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../../project/Depots-table-2.html">
            
                <a href="../../project/Depots-table-2.html">
            
                    
                    6.分库分表二
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >2.大数据技术之Kafka</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div class="treeview__container"><div class="treeview__container-title"><span class="treeview__main-title">Treeview</span><span class="treeview__copyright">Copyright &#xA9; aleen42 all right reserved, powered by <a href="https://github.com/aleen42" target="_blank">aleen42</a></span></div><ul>
<li> 
<ul>
<li><div><a href="#11-&#x7B80;&#x4ECB;">1.1 &#x7B80;&#x4ECB;</a><i></i></div></li>
<li><div><a href="#12-&#x7279;&#x70B9;">1.2 &#x7279;&#x70B9;</a><i></i></div></li>
<li><div><a href="#13-&#x573A;&#x666F;">1.3 &#x573A;&#x666F;</a><i></i></div></li>
<li><div><a href="#14-&#x67B6;&#x6784;">1.4 &#x67B6;&#x6784;</a><i></i></div></li>
</ul></li>
<li><div><a href="#2kafka-&#x73AF;&#x5883;&#x642D;&#x5EFA;">2.kafka &#x73AF;&#x5883;&#x642D;&#x5EFA;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#1&#xFF09;&#x89E3;&#x538B;&#x5B89;&#x88C5;&#x5305;">1&#xFF09;&#x89E3;&#x538B;&#x5B89;&#x88C5;&#x5305;</a><i></i></div></li>
<li><div><a href="#2&#xFF09;&#x5728;kafka212-260-&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;-logs-&#x6587;&#x4EF6;&#x5939;">2&#xFF09;&#x5728;kafka_2.12-2.6.0 &#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA; logs &#x6587;&#x4EF6;&#x5939;</a><i></i></div></li>
<li><div><a href="#3&#xFF09;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;">3&#xFF09;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</a><i></i></div></li>
<li><div><a href="#4&#xFF09;&#x5206;&#x53D1;&#x5B89;&#x88C5;&#x5305;">4&#xFF09;&#x5206;&#x53D1;&#x5B89;&#x88C5;&#x5305;</a><i></i></div></li>
<li><div><a href="#5&#xFF09;&#x5206;&#x522B;&#x5728;-hadoop102-&#x548C;-hadoop103-&#x4E0A;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;-configserverproperties-&#x4E2D;&#x7684;-brokerid1&#x3001;brokerid2">5&#xFF09;&#x5206;&#x522B;&#x5728; hadoop102 &#x548C; hadoop103 &#x4E0A;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6; config/server.properties &#x4E2D;&#x7684; broker.id=1&#x3001;broker.id=2</a><i></i></div></li>
<li><div><a href="#8&#xFF09;&#x542F;&#x52A8;&#x96C6;&#x7FA4;">8&#xFF09;&#x542F;&#x52A8;&#x96C6;&#x7FA4;</a><i></i></div></li>
<li><div><a href="#9&#xFF09;&#x5173;&#x95ED;&#x96C6;&#x7FA4;">9&#xFF09;&#x5173;&#x95ED;&#x96C6;&#x7FA4;</a><i></i></div></li>
</ul></li>
<li><div><a href="#3kafka-shell-&#x4F7F;&#x7528;">3.Kafka shell &#x4F7F;&#x7528;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#1&#xFF09;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x7684;&#x6240;&#x6709;-topic">1&#xFF09;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x7684;&#x6240;&#x6709; topic</a><i></i></div></li>
<li><div><a href="#2&#xFF09;&#x521B;&#x5EFA;-topic">2&#xFF09;&#x521B;&#x5EFA; topic</a><i></i></div></li>
<li><div><a href="#3&#xFF09;&#x5220;&#x9664;-topic">3&#xFF09;&#x5220;&#x9664; topic</a><i></i></div></li>
<li><div><a href="#4&#xFF09;&#x53D1;&#x9001;&#x6D88;&#x606F;">4&#xFF09;&#x53D1;&#x9001;&#x6D88;&#x606F;</a><i></i></div></li>
<li><div><a href="#5&#xFF09;&#x6D88;&#x8D39;&#x6D88;&#x606F;">5&#xFF09;&#x6D88;&#x8D39;&#x6D88;&#x606F;</a><i></i></div></li>
<li><div><a href="#6&#xFF09;&#x67E5;&#x770B;&#x67D0;&#x4E2A;-topic-&#x7684;&#x8BE6;&#x60C5;">6&#xFF09;&#x67E5;&#x770B;&#x67D0;&#x4E2A; Topic &#x7684;&#x8BE6;&#x60C5;</a><i></i></div></li>
</ul></li>
<li><div><a href="#4-kafka-api-&#x5B9E;&#x6218;">4. Kafka API &#x5B9E;&#x6218;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#41-&#x73AF;&#x5883;&#x51C6;&#x5907;">4.1 &#x73AF;&#x5883;&#x51C6;&#x5907;</a><i></i></div></li>
<li><div><a href="#42-kafka-&#x751F;&#x4EA7;&#x8005;-java-api">4.2 Kafka &#x751F;&#x4EA7;&#x8005; Java API</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#421-&#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x8FC7;&#x65F6;&#x7684;-api&#xFF09;">4.2.1 &#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x8FC7;&#x65F6;&#x7684; API&#xFF09;</a><i></i></div></li>
<li><div><a href="#422-&#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x65B0;-api&#xFF09;">4.2.2 &#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x65B0; API&#xFF09;</a><i></i></div></li>
<li><div><a href="#423-&#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#x5E26;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF08;&#x65B0;-api&#xFF09;">4.2.3 &#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#x5E26;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF08;&#x65B0; API&#xFF09;</a><i></i></div></li>
<li><div><a href="#424-&#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x533A;&#x751F;&#x4EA7;&#x8005;">4.2.4 &#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x533A;&#x751F;&#x4EA7;&#x8005;</a><i></i></div></li>
</ul></li>
<li><div><a href="#43-kafka-&#x6D88;&#x8D39;&#x8005;-java-api">4.3 Kafka &#x6D88;&#x8D39;&#x8005; Java API</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#431-&#x9AD8;&#x7EA7;-api">4.3.1 &#x9AD8;&#x7EA7; API</a><i></i></div></li>
<li><div><a href="#432-&#x4F4E;&#x7EA7;-api">4.3.2 &#x4F4E;&#x7EA7; API</a><i></i></div></li>
</ul></li>
</ul></li>
<li><div><a href="#5-kafka-producer-&#x62E6;&#x622A;&#x5668;interceptor">5. Kafka producer &#x62E6;&#x622A;&#x5668;(interceptor)</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#51-&#x62E6;&#x622A;&#x5668;&#x539F;&#x7406;">5.1 &#x62E6;&#x622A;&#x5668;&#x539F;&#x7406;</a><i></i></div></li>
</ul></li>
<li><div><a href="#6-kafka-&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x5206;&#x6790;">6. Kafka &#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x5206;&#x6790;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#31-kafka-&#x751F;&#x4EA7;&#x8FC7;&#x7A0B;&#x5206;&#x6790;">3.1 Kafka &#x751F;&#x4EA7;&#x8FC7;&#x7A0B;&#x5206;&#x6790;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#311-&#x5199;&#x5165;&#x65B9;&#x5F0F;">3.1.1 &#x5199;&#x5165;&#x65B9;&#x5F0F;</a><i></i></div></li>
<li><div><a href="#312-&#x5206;&#x533A;&#xFF08;partition&#xFF09;">3.1.2 &#x5206;&#x533A;&#xFF08;Partition&#xFF09;</a><i></i></div></li>
<li><div><a href="#313-&#x526F;&#x672C;&#xFF08;replication&#xFF09;">3.1.3 &#x526F;&#x672C;&#xFF08;Replication&#xFF09;</a><i></i></div></li>
<li><div><a href="#314-&#x5199;&#x5165;&#x6D41;&#x7A0B;">3.1.4 &#x5199;&#x5165;&#x6D41;&#x7A0B;</a><i></i></div></li>
</ul></li>
<li><div><a href="#32-broker-&#x4FDD;&#x5B58;&#x6D88;&#x606F;">3.2 Broker &#x4FDD;&#x5B58;&#x6D88;&#x606F;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#321-&#x5B58;&#x50A8;&#x65B9;&#x5F0F;">3.2.1 &#x5B58;&#x50A8;&#x65B9;&#x5F0F;</a><i></i></div></li>
<li><div><a href="#322-&#x5B58;&#x50A8;&#x7B56;&#x7565;">3.2.2 &#x5B58;&#x50A8;&#x7B56;&#x7565;</a><i></i></div></li>
<li><div><a href="#323-zookeeper-&#x5B58;&#x50A8;&#x7ED3;&#x6784;">3.2.3 Zookeeper &#x5B58;&#x50A8;&#x7ED3;&#x6784;</a><i></i></div></li>
</ul></li>
<li><div><a href="#33-kafka-&#x6D88;&#x8D39;&#x8FC7;&#x7A0B;&#x5206;&#x6790;">3.3 Kafka &#x6D88;&#x8D39;&#x8FC7;&#x7A0B;&#x5206;&#x6790;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#331-&#x9AD8;&#x7EA7;-api">3.3.1 &#x9AD8;&#x7EA7; API</a><i></i></div></li>
<li><div><a href="#332-&#x4F4E;&#x7EA7;-api">3.3.2 &#x4F4E;&#x7EA7; API</a><i></i></div></li>
<li><div><a href="#333-&#x6D88;&#x8D39;&#x8005;&#x7EC4;">3.3.3 &#x6D88;&#x8D39;&#x8005;&#x7EC4;</a><i></i></div></li>
<li><div><a href="#334-&#x6D88;&#x8D39;&#x65B9;&#x5F0F;">3.3.4 &#x6D88;&#x8D39;&#x65B9;&#x5F0F;</a><i></i></div></li>
<li><div><a href="#335-&#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x6848;&#x4F8B;">3.3.5 &#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x6848;&#x4F8B;</a><i></i></div></li>
</ul></li>
</ul></li>
<li><div><a href="#7-&#x6269;&#x5C55;">7. &#x6269;&#x5C55;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#71-kafka-&#x4E0E;-flume-&#x6BD4;&#x8F83;">7.1 Kafka &#x4E0E; Flume &#x6BD4;&#x8F83;</a><i></i></div></li>
<li><div><a href="#72-flume-&#x4E0E;-kafka-&#x96C6;&#x6210;">7.2 Flume &#x4E0E; kafka &#x96C6;&#x6210;</a><i></i></div></li>
<li><div><a href="#73-kafka-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3 Kafka &#x914D;&#x7F6E;&#x4FE1;&#x606F;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#731-broker-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3.1 Broker &#x914D;&#x7F6E;&#x4FE1;&#x606F;</a><i></i></div></li>
<li><div><a href="#732-producer-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3.2 Producer &#x914D;&#x7F6E;&#x4FE1;&#x606F;</a><i></i></div></li>
<li><div><a href="#733-consumer-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3.3 Consumer &#x914D;&#x7F6E;&#x4FE1;&#x606F;</a><i></i></div></li>
</ul></li>
</ul></li>
</ul>
</div>

<h1 id="1&#x6982;&#x8FF0;">1.&#x6982;&#x8FF0;</h1>
<h2 id="11-&#x7B80;&#x4ECB;">1.1 &#x7B80;&#x4ECB;</h2>
<p>Apache Kafka &#x662F;&#x4E00;&#x4E2A;<strong>&#x5206;&#x5E03;&#x5F0F;&#x6D88;&#x606F;</strong>&#x7CFB;&#x7EDF;&#xFF0C;&#x7531;Scala&#x5199;&#x6210;&#x3002;&#x662F;&#x7531; Apache &#x8F6F;&#x4EF6;&#x57FA;&#x91D1;&#x4F1A;&#x5F00;&#x53D1;&#x7684;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x9879;&#x76EE;</p>
<h2 id="12-&#x7279;&#x70B9;">1.2 &#x7279;&#x70B9;</h2>
<p>&#x9AD8;&#x541E;&#x5410;&#x91CF;&#xFF1A;Kafka &#x6BCF;&#x79D2;&#x53EF;&#x4EE5;&#x751F;&#x4EA7;&#x7EA6; 25 &#x4E07;&#x6D88;&#x606F;&#xFF08;50 MB&#xFF09;&#xFF0C;&#x6BCF;&#x79D2;&#x5904;&#x7406; 55 &#x4E07;&#x6D88;&#x606F;&#xFF08;110 MB&#xFF09;</p>
<p>&#x6301;&#x4E45;&#x5316;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF1A;&#x53EF;&#x8FDB;&#x884C;&#x6301;&#x4E45;&#x5316;&#x64CD;&#x4F5C;&#x3002;&#x5C06;&#x6D88;&#x606F;&#x6301;&#x4E45;&#x5316;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x7528;&#x4E8E;&#x6279;&#x91CF;&#x6D88;&#x8D39;&#xFF0C;&#x4F8B;&#x5982; ETL&#xFF0C;&#x4EE5;&#x53CA;&#x5B9E;&#x65F6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x901A;&#x8FC7;&#x5C06;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x5230;&#x786C;&#x76D8;&#x4EE5;&#x53CA; replication &#x9632;&#x6B62;&#x6570;&#x636E;&#x4E22;&#x5931;&#x3002;</p>
<p>&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x6613;&#x4E8E;&#x6269;&#x5C55;&#xFF1A;&#x6240;&#x6709;&#x7684; producer&#x3001;broker &#x548C; consumer &#x90FD;&#x4F1A;&#x6709;&#x591A;&#x4E2A;&#xFF0C;&#x5747;&#x4E3A;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x3002;&#x65E0;&#x9700;&#x505C;&#x673A;&#x5373;&#x53EF;&#x6269;&#x5C55;&#x673A;&#x5668;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x72B6;&#x6001;&#x7EF4;&#x62A4;&#xFF1A;&#x6D88;&#x606F;&#x88AB;&#x5904;&#x7406;&#x7684;&#x72B6;&#x6001;&#x662F;&#x5728; consumer &#x7AEF;&#x7EF4;&#x62A4;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7531; server &#x7AEF;&#x7EF4;&#x62A4;&#x3002;&#x5F53;&#x5931;&#x8D25;&#x65F6;&#x80FD;&#x81EA;&#x52A8;&#x5E73;&#x8861;&#x3002;</p>
<h2 id="13-&#x573A;&#x666F;">1.3 &#x573A;&#x666F;</h2>
<p>&#x5927;&#x6570;&#x636E;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7F13;&#x5B58;</p>
<h2 id="14-&#x67B6;&#x6784;">1.4 &#x67B6;&#x6784;</h2>
<p><img src="https://uploader.shimo.im/f/7iilSCGZwR2yZRYQ.png!thumbnail?fileGuid=kcDQJ8PgC8thg6gD" alt="&#x56FE;&#x7247;"></p>
<p><img src="https://uploader.shimo.im/f/Ifct6DMz4aUcF1Ug.png!thumbnail?fileGuid=kcDQJ8PgC8thg6gD" alt="&#x56FE;&#x7247;"></p>
<h1 id="2kafka-&#x73AF;&#x5883;&#x642D;&#x5EFA;">2.kafka &#x73AF;&#x5883;&#x642D;&#x5EFA;</h1>
<h2 id="1&#xFF09;&#x89E3;&#x538B;&#x5B89;&#x88C5;&#x5305;">1&#xFF09;&#x89E3;&#x538B;&#x5B89;&#x88C5;&#x5305;</h2>
<pre class="language-"><code class="lang-shell"><span class="token function">tar</span> -zxvf kafka_2.12-2.6.0.tgz -C /usr/local/software
</code></pre>
<h2 id="2&#xFF09;&#x5728;kafka212-260-&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;-logs-&#x6587;&#x4EF6;&#x5939;">2&#xFF09;&#x5728;kafka_2.12-2.6.0 &#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA; logs &#x6587;&#x4EF6;&#x5939;</h2>
<pre class="language-"><code class="lang-shell"> <span class="token builtin class-name">cd</span> kafka_2.12-2.6.0 <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> logs
</code></pre>
<h2 id="3&#xFF09;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;">3&#xFF09;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h2>
<p>vim server.properties</p>
<p>&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre class="language-"><code class="lang-xml">#broker &#x7684;&#x5168;&#x5C40;&#x552F;&#x4E00;&#x7F16;&#x53F7;&#xFF0C;&#x4E0D;&#x80FD;&#x91CD;&#x590D;
broker.id=0
#&#x5220;&#x9664; topic &#x529F;&#x80FD;&#x4F7F;&#x80FD;
delete.topic.enable=true
#&#x5904;&#x7406;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;
num.network.threads=3
#&#x7528;&#x6765;&#x5904;&#x7406;&#x78C1;&#x76D8; IO &#x7684;&#x73B0;&#x6210;&#x6570;&#x91CF;
num.io.threads=8
#&#x53D1;&#x9001;&#x5957;&#x63A5;&#x5B57;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;
socket.send.buffer.bytes=102400
#&#x63A5;&#x6536;&#x5957;&#x63A5;&#x5B57;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;
socket.receive.buffer.bytes=102400
#&#x8BF7;&#x6C42;&#x5957;&#x63A5;&#x5B57;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;
socket.request.max.bytes=104857600
#kafka &#x8FD0;&#x884C;&#x65E5;&#x5FD7;&#x5B58;&#x653E;&#x7684;&#x8DEF;&#x5F84;
log.dirs=/usr/local/software/kafka_2.12-2.6.0/logs
#topic &#x5728;&#x5F53;&#x524D; broker &#x4E0A;&#x7684;&#x5206;&#x533A;&#x4E2A;&#x6570;
num.partitions=1
#&#x7528;&#x6765;&#x6062;&#x590D;&#x548C;&#x6E05;&#x7406; data &#x4E0B;&#x6570;&#x636E;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;
num.recovery.threads.per.data.dir=1
#segment &#x6587;&#x4EF6;&#x4FDD;&#x7559;&#x7684;&#x6700;&#x957F;&#x65F6;&#x95F4;&#xFF0C;&#x8D85;&#x65F6;&#x5C06;&#x88AB;&#x5220;&#x9664;
log.retention.hours=168
#&#x914D;&#x7F6E;&#x8FDE;&#x63A5; Zookeeper &#x96C6;&#x7FA4;&#x5730;&#x5740;
zookeeper.connect=hadoop101:2181,hadoop102:2181,hadoop103:2181
</code></pre>
<p>broker.id=0
log.dirs=/usr/local/software/kafka_2.12-2.6.0/logs</p>
<p>zookeeper.connect=hadoop101:2181,hadoop102:2181,hadoop103:2181</p>
<h2 id="4&#xFF09;&#x5206;&#x53D1;&#x5B89;&#x88C5;&#x5305;">4&#xFF09;&#x5206;&#x53D1;&#x5B89;&#x88C5;&#x5305;</h2>
<pre class="language-"><code class="lang-shell">xsync kafka_2.12-2.6.0
</code></pre>
<p>&#x6CE8;&#x610F;&#xFF1A;&#x5206;&#x53D1;&#x4E4B;&#x540E;&#x8BB0;&#x5F97;&#x914D;&#x7F6E;&#x5176;&#x4ED6;&#x673A;&#x5668;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;</p>
<h2 id="5&#xFF09;&#x5206;&#x522B;&#x5728;-hadoop102-&#x548C;-hadoop103-&#x4E0A;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;-configserverproperties-&#x4E2D;&#x7684;-brokerid1&#x3001;brokerid2">5&#xFF09;&#x5206;&#x522B;&#x5728; hadoop102 &#x548C; hadoop103 &#x4E0A;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6; config/server.properties &#x4E2D;&#x7684; broker.id=1&#x3001;broker.id=2</h2>
<p>&#x6CE8;&#xFF1A;broker.id &#x4E0D;&#x5F97;&#x91CD;&#x590D;</p>
<h2 id="8&#xFF09;&#x542F;&#x52A8;&#x96C6;&#x7FA4;">8&#xFF09;&#x542F;&#x52A8;&#x96C6;&#x7FA4;</h2>
<p>&#x4F9D;&#x6B21;&#x5728; hadoop101&#x3001;hadoop102&#x3001;hadoop103 &#x8282;&#x70B9;&#x4E0A;&#x542F;&#x52A8; kafka</p>
<pre class="language-"><code class="lang-shell">bin/kafka-server-start.sh config/server.properties <span class="token operator">&amp;</span>
</code></pre>
<h2 id="9&#xFF09;&#x5173;&#x95ED;&#x96C6;&#x7FA4;">9&#xFF09;&#x5173;&#x95ED;&#x96C6;&#x7FA4;</h2>
<p>&#x4F9D;&#x6B21;&#x5728; hadoop101&#x3001;hadoop102&#x3001;hadoop103 &#x8282;&#x70B9;&#x4E0A;&#x5173;&#x95ED; kafka</p>
<pre class="language-"><code class="lang-shell">bin/kafka-server-stop.sh stop
</code></pre>
<h1 id="3kafka-shell-&#x4F7F;&#x7528;">3.Kafka shell &#x4F7F;&#x7528;</h1>
<h2 id="1&#xFF09;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x7684;&#x6240;&#x6709;-topic">1&#xFF09;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x7684;&#x6240;&#x6709; topic</h2>
<pre class="language-"><code class="lang-shell">bin/kafka-topics.sh --zookeeper hadoop101:2181 --list
</code></pre>
<h2 id="2&#xFF09;&#x521B;&#x5EFA;-topic">2&#xFF09;&#x521B;&#x5EFA; topic</h2>
<pre class="language-"><code class="lang-shell">bin/kafka-topics.sh --zookeeper hadoop101:2181 --create --replication-factor <span class="token number">1</span> --partitions <span class="token number">1</span> --topic first
</code></pre>
<p>&#x9009;&#x9879;&#x8BF4;&#x660E;&#xFF1A;
--topic &#x5B9A;&#x4E49; topic &#x540D;</p>
<p>--replication-factor  &#x5B9A;&#x4E49;&#x526F;&#x672C;&#x6570;</p>
<p>--partitions  &#x5B9A;&#x4E49;&#x5206;&#x533A;&#x6570;</p>
<pre class="language-"><code class="lang-plain">bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server hadoop101:9092
</code></pre>
<h2 id="3&#xFF09;&#x5220;&#x9664;-topic">3&#xFF09;&#x5220;&#x9664; topic</h2>
<pre class="language-"><code class="lang-shell">bin/kafka-topics.sh --zookeeper hadoop101:2181 --delete --topic first
</code></pre>
<p>&#x9700;&#x8981; server.properties &#x4E2D;&#x8BBE;&#x7F6E; delete.topic.enable=true &#x5426;&#x5219;&#x53EA;&#x662F;&#x6807;&#x8BB0;&#x5220;&#x9664;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x91CD;&#x542F;&#x3002;</p>
<h2 id="4&#xFF09;&#x53D1;&#x9001;&#x6D88;&#x606F;">4&#xFF09;&#x53D1;&#x9001;&#x6D88;&#x606F;</h2>
<pre class="language-"><code class="lang-shell">bin/kafka-console-producer.sh --broker-list hadoop101:9092 --topic first
</code></pre>
<blockquote>
<p>hello world</p>
<pre class="language-"><code class="lang-plain">bin/kafka-console-producer.sh --topic quickstart-events --bootstrap-server hadoop101:9092
</code></pre>
<h2 id="5&#xFF09;&#x6D88;&#x8D39;&#x6D88;&#x606F;">5&#xFF09;&#x6D88;&#x8D39;&#x6D88;&#x606F;</h2>
</blockquote>
<pre class="language-"><code class="lang-shell">bin/kafka-console-consumer.sh --zookeeper hadoop101:2181 --from-beginning --topic first
</code></pre>
<p>--from-beginning&#xFF1A;&#x4F1A;&#x628A; first &#x4E3B;&#x9898;&#x4E2D;&#x4EE5;&#x5F80;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x90FD;&#x8BFB;&#x53D6;&#x51FA;&#x6765;&#x3002;&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x9009;&#x62E9;&#x662F;&#x5426;&#x589E;&#x52A0;&#x8BE5;&#x914D;&#x7F6E;&#x3002;</p>
<pre class="language-"><code class="lang-plain">bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server hadoop101:9092
</code></pre>
<h2 id="6&#xFF09;&#x67E5;&#x770B;&#x67D0;&#x4E2A;-topic-&#x7684;&#x8BE6;&#x60C5;">6&#xFF09;&#x67E5;&#x770B;&#x67D0;&#x4E2A; Topic &#x7684;&#x8BE6;&#x60C5;</h2>
<pre class="language-"><code class="lang-shell">bin/kafka-topics.sh --zookeeper hadoop101:2181 --describe --topic first
</code></pre>
<pre class="language-"><code class="lang-plain">bin/kafka-topics.sh --describe --topic quickstart-events --bootstrap-server hadoop101:9092
</code></pre>
<h1 id="4-kafka-api-&#x5B9E;&#x6218;">4. Kafka API &#x5B9E;&#x6218;</h1>
<h2 id="41-&#x73AF;&#x5883;&#x51C6;&#x5907;">4.1 &#x73AF;&#x5883;&#x51C6;&#x5907;</h2>
<p>1&#xFF09;&#x542F;&#x52A8; zk &#x548C; kafka &#x96C6;&#x7FA4;&#xFF0C;&#x5728; kafka &#x96C6;&#x7FA4;&#x4E2D;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;</p>
<pre class="language-"><code class="lang-shell">bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server hadoop101:9092
</code></pre>
<p>2&#xFF09;&#x5BFC;&#x5165; pom &#x4F9D;&#x8D56;</p>
<pre class="language-"><code class="lang-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kafka-clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.11.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kafka_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.11.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="42-kafka-&#x751F;&#x4EA7;&#x8005;-java-api">4.2 Kafka &#x751F;&#x4EA7;&#x8005; Java API</h2>
<h3 id="421-&#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x8FC7;&#x65F6;&#x7684;-api&#xFF09;">4.2.1 &#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x8FC7;&#x65F6;&#x7684; API&#xFF09;</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>javaapi<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KeyedMessage</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerConfig</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OldProducer</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;metadata.broker.list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop102:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;request.required.acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;serializer.class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;kafka.serializer.StringEncoder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerConfig</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">KeyedMessage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyedMessage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="422-&#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x65B0;-api&#xFF09;">4.2.2 &#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x65B0; API&#xFF09;</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Kafka &#x670D;&#x52A1;&#x7AEF;&#x7684;&#x4E3B;&#x673A;&#x540D;&#x548C;&#x7AEF;&#x53E3;&#x53F7;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop103:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x7B49;&#x5F85;&#x6240;&#x6709;&#x526F;&#x672C;&#x8282;&#x70B9;&#x7684;&#x5E94;&#x7B54;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x6D88;&#x606F;&#x53D1;&#x9001;&#x6700;&#x5927;&#x5C1D;&#x8BD5;&#x6B21;&#x6570;  </span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;retries&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x4E00;&#x6279;&#x6D88;&#x606F;&#x5904;&#x7406;&#x5927;&#x5C0F;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;batch.size&quot;</span><span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x8BF7;&#x6C42;&#x5EF6;&#x65F6;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;linger.ms&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x53D1;&#x9001;&#x7F13;&#x5B58;&#x533A;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;buffer.memory&quot;</span><span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// key &#x5E8F;&#x5217;&#x5316;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// value &#x5E8F;&#x5217;&#x5316;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



        <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="423-&#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#x5E26;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF08;&#x65B0;-api&#xFF09;">4.2.3 &#x521B;&#x5EFA;&#x751F;&#x4EA7;&#x8005;&#x5E26;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF08;&#x65B0; API&#xFF09;</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Callback</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">RecordMetadata</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallBackProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Kafka &#x670D;&#x52A1;&#x7AEF;&#x7684;&#x4E3B;&#x673A;&#x540D;&#x548C;&#x7AEF;&#x53E3;&#x53F7;  </span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop103:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x7B49;&#x5F85;&#x6240;&#x6709;&#x526F;&#x672C;&#x8282;&#x70B9;&#x7684;&#x5E94;&#x7B54;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x6D88;&#x606F;&#x53D1;&#x9001;&#x6700;&#x5927;&#x5C1D;&#x8BD5;&#x6B21;&#x6570;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;retries&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x4E00;&#x6279;&#x6D88;&#x606F;&#x5904;&#x7406;&#x5927;&#x5C0F;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;batch.size&quot;</span><span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x589E;&#x52A0;&#x670D;&#x52A1;&#x7AEF;&#x8BF7;&#x6C42;&#x5EF6;&#x65F6;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;linger.ms&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x53D1;&#x9001;&#x7F13;&#x5B58;&#x533A;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;buffer.memory&quot;</span><span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// key &#x5E8F;&#x5217;&#x5316;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// value &#x5E8F;&#x5217;&#x5316;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>metadata <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>metadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>

        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="424-&#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x533A;&#x751F;&#x4EA7;&#x8005;">4.2.4 &#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x533A;&#x751F;&#x4EA7;&#x8005;</h3>
<p>0&#xFF09;&#x9700;&#x6C42;&#xFF1A;&#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5230; topic &#x7684;&#x7B2C; 0 &#x53F7;&#x5206;&#x533A;&#x4E0A;</p>
<p>1&#xFF09;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7C7B;&#x5B9E;&#x73B0; Partitioner &#x63A5;&#x53E3;&#xFF0C;&#x91CD;&#x5199;&#x91CC;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#xFF08;&#x8FC7;&#x65F6; API&#xFF09;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Partitioner</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomPartitioner</span> <span class="token keyword">implements</span> <span class="token class-name">Partitioner</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">CustomPartitioner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> numPartitions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x63A7;&#x5236;&#x5206;&#x533A;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token number">2</span>&#xFF09;&#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x533A;&#xFF08;&#x65B0; API&#xFF09;
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Partitioner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">Cluster</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomPartitioner</span> <span class="token keyword">implements</span> <span class="token class-name">Partitioner</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> configs<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keyBytes<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> valueBytes<span class="token punctuation">,</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// &#x63A7;&#x5236;&#x5206;&#x533A;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3&#xFF09;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x8C03;&#x7528;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PartitionerProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Kafka &#x670D;&#x52A1;&#x7AEF;&#x7684;&#x4E3B;&#x673A;&#x540D;&#x548C;&#x7AEF;&#x53E3;&#x53F7;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop103:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x7B49;&#x5F85;&#x6240;&#x6709;&#x526F;&#x672C;&#x8282;&#x70B9;&#x7684;&#x5E94;&#x7B54;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x6D88;&#x606F;&#x53D1;&#x9001;&#x6700;&#x5927;&#x5C1D;&#x8BD5;&#x6B21;&#x6570;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;retries&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x4E00;&#x6279;&#x6D88;&#x606F;&#x5904;&#x7406;&#x5927;&#x5C0F;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;batch.size&quot;</span><span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x589E;&#x52A0;&#x670D;&#x52A1;&#x7AEF;&#x8BF7;&#x6C42;&#x5EF6;&#x65F6;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;linger.ms&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x53D1;&#x9001;&#x7F13;&#x5B58;&#x533A;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;buffer.memory&quot;</span><span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// key &#x5E8F;&#x5217;&#x5316;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// value &#x5E8F;&#x5217;&#x5316;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x533A;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;partitioner.class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.haha.kafka.CustomPartitioner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

    producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;haha&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4&#xFF09;&#x6D4B;&#x8BD5;
&#xFF08;1&#xFF09;&#x5728; hadoop102 &#x4E0A;&#x76D1;&#x63A7;/opt/module/kafka/logs/&#x76EE;&#x5F55;&#x4E0B; first &#x4E3B;&#x9898; 3 &#x4E2A;&#x5206;&#x533A;&#x7684; log &#x65E5;&#x5FD7;&#x52A8;&#x6001;&#x53D8;&#x5316;&#x60C5;&#x51B5;</p>
<pre class="language-"><code class="lang-plain"> tail -f 00000000000000000000.log
</code></pre>
<p>&#xFF08;2&#xFF09;&#x53D1;&#x73B0;&#x6570;&#x636E;&#x90FD;&#x5B58;&#x50A8;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x5206;&#x533A;&#x4E86;&#x3002;</p>
<h2 id="43-kafka-&#x6D88;&#x8D39;&#x8005;-java-api">4.3 Kafka &#x6D88;&#x8D39;&#x8005; Java API</h2>
<h3 id="431-&#x9AD8;&#x7EA7;-api">4.3.1 &#x9AD8;&#x7EA7; API</h3>
<p>0&#xFF09;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x521B;&#x5EFA;&#x53D1;&#x9001;&#x8005;</p>
<pre class="language-"><code class="lang-plain">bin/kafka-console-producer.sh \
--broker-list hadoop102:9092 --topic first
&gt;hello world
</code></pre>
<p>1&#xFF09;&#x521B;&#x5EFA;&#x6D88;&#x8D39;&#x8005;&#xFF08;&#x8FC7;&#x65F6; API&#xFF09;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerIterator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">KafkaStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">kafka<span class="token punctuation">.</span>javaapi<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerConnector</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomConsumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;zookeeper.connect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop102:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;zookeeper.session.timeout.ms&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;500&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;zookeeper.sync.time.ms&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;250&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auto.commit.interval.ms&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x521B;&#x5EFA;&#x6D88;&#x8D39;&#x8005;&#x8FDE;&#x63A5;&#x5668;</span>
    <span class="token class-name">ConsumerConnector</span> consumer <span class="token operator">=</span> <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">createJavaConsumerConnector</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConsumerConfig</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> topicCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    topicCount<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">KafkaStream</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;&gt;</span> consumerMap <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">createMessageStreams</span><span class="token punctuation">(</span>topicCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">KafkaStream</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> stream <span class="token operator">=</span> consumerMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ConsumerIterator</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> it <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2&#xFF09;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x6848;&#x4F8B;&#xFF08;&#x81EA;&#x52A8;&#x7EF4;&#x62A4;&#x6D88;&#x8D39;&#x60C5;&#x51B5;&#xFF09;&#xFF08;&#x65B0; API&#xFF09;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerRecord</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerRecords</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">KafkaConsumer</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomNewConsumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x5B9A;&#x4E49; kakfa &#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5C06;&#x6240;&#x6709; broker &#x6307;&#x5B9A;&#x4E0A; </span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop102:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x5236;&#x5B9A; consumer group </span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x662F;&#x5426;&#x81EA;&#x52A8;&#x786E;&#x8BA4; offset </span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;enable.auto.commit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x81EA;&#x52A8;&#x786E;&#x8BA4; offset &#x7684;&#x65F6;&#x95F4;&#x95F4;&#x9694; </span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auto.commit.interval.ms&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// key &#x7684;&#x5E8F;&#x5217;&#x5316;&#x7C7B;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.deserializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// value &#x7684;&#x5E8F;&#x5217;&#x5316;&#x7C7B; </span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.deserializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x5B9A;&#x4E49; consumer </span>
        <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x6D88;&#x8D39;&#x8005;&#x8BA2;&#x9605;&#x7684; topic, &#x53EF;&#x540C;&#x65F6;&#x8BA2;&#x9605;&#x591A;&#x4E2A; </span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;second&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;third&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// &#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x8BFB;&#x53D6;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x4E3A; 100ms </span>
        <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">record</span> <span class="token operator">:</span> records<span class="token punctuation">)</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;offset = %d, key = %s, value = %s%n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="432-&#x4F4E;&#x7EA7;-api">4.3.2 &#x4F4E;&#x7EA7; API</h3>
<p>&#x5B9E;&#x73B0;&#x4F7F;&#x7528;&#x4F4E;&#x7EA7; API &#x8BFB;&#x53D6;&#x6307;&#x5B9A; topic&#xFF0C;&#x6307;&#x5B9A; partition,&#x6307;&#x5B9A; offset &#x7684;&#x6570;&#x636E;&#x3002;</p>
<p>1&#xFF09;&#x6D88;&#x8D39;&#x8005;&#x4F7F;&#x7528;&#x4F4E;&#x7EA7; API &#x7684;&#x4E3B;&#x8981;&#x6B65;&#x9AA4;&#xFF1A;</p>
<p>&#x6B65;&#x9AA4;    &#x4E3B;&#x8981;&#x5DE5;&#x4F5C;</p>
<p>1    &#x6839;&#x636E;&#x6307;&#x5B9A;&#x7684;&#x5206;&#x533A;&#x4ECE;&#x4E3B;&#x9898;&#x5143;&#x6570;&#x636E;&#x4E2D;&#x627E;&#x5230;&#x4E3B;&#x526F;&#x672C;</p>
<p>2    &#x83B7;&#x53D6;&#x5206;&#x533A;&#x6700;&#x65B0;&#x7684;&#x6D88;&#x8D39;&#x8FDB;&#x5EA6;</p>
<p>3    &#x4ECE;&#x4E3B;&#x526F;&#x672C;&#x62C9;&#x53D6;&#x5206;&#x533A;&#x7684;&#x6D88;&#x606F;</p>
<p>4    &#x8BC6;&#x522B;&#x4E3B;&#x526F;&#x672C;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x91CD;&#x8BD5;</p>
<p>2&#xFF09;&#x65B9;&#x6CD5;&#x63CF;&#x8FF0;&#xFF1A;</p>
<p>findLeader()    &#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x79CD;&#x5B50;&#x8282;&#x70B9;&#x53D1;&#x9001;&#x4E3B;&#x9898;&#x5143;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x526F;&#x672C;&#x96C6;&#x52A0;&#x5165;&#x5907;&#x7528;&#x8282;&#x70B9;</p>
<p>getLastOffset()    &#x6D88;&#x8D39;&#x8005;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x504F;&#x79FB;&#x91CF;&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x5206;&#x533A;&#x6700;&#x8FD1;&#x7684;&#x504F;&#x79FB;&#x91CF;</p>
<p>run()    &#x6D88;&#x8D39;&#x8005;&#x4F4E;&#x7EA7; AP I &#x62C9;&#x53D6;&#x6D88;&#x606F;&#x7684;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;</p>
<p>findNewLeader()    &#x5F53;&#x5206;&#x533A;&#x7684;&#x4E3B;&#x526F;&#x672C;&#x8282;&#x70B9;&#x53D1;&#x751F;&#x6545;&#x969C;&#xFF0C;&#x5BA2;&#x6237;&#x5C06;&#x8981;&#x627E;&#x51FA;&#x65B0;&#x7684;&#x4E3B;&#x526F;&#x672C;</p>
<p>3&#xFF09;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>import java.nio.ByteBuffer;</p>
<p>import java.util.ArrayList;</p>
<p>import java.util.Collections;</p>
<p>import java.util.HashMap;</p>
<p>import java.util.List;</p>
<p>import java.util.Map;</p>
<p>import kafka.api.FetchRequest;</p>
<p>import kafka.api.FetchRequestBuilder;</p>
<p>import kafka.api.PartitionOffsetRequestInfo;</p>
<p>import kafka.cluster.BrokerEndPoint;</p>
<p>import kafka.common.ErrorMapping;</p>
<p>import kafka.common.TopicAndPartition;</p>
<p>import kafka.javaapi.FetchResponse;</p>
<p>import kafka.javaapi.OffsetResponse;</p>
<p>import kafka.javaapi.PartitionMetadata;</p>
<p>import kafka.javaapi.TopicMetadata;</p>
<p>import kafka.javaapi.TopicMetadataRequest;</p>
<p>import kafka.javaapi.consumer.SimpleConsumer;</p>
<p>import kafka.message.MessageAndOffset;</p>
<p>public class SimpleExample {</p>
<p>private List<string> m_replicaBrokers = new ArrayList&lt;&gt;();</string></p>
<p>public SimpleExample() {</p>
<p>m_replicaBrokers = new ArrayList&lt;&gt;();</p>
<p>}</p>
<p>public static void main(String args[]) {</p>
<p>SimpleExample example = new SimpleExample();</p>
<p>// &#x6700;&#x5927;&#x8BFB;&#x53D6;&#x6D88;&#x606F;&#x6570;&#x91CF;</p>
<p>long maxReads = Long.parseLong(&quot;3&quot;);</p>
<p>// &#x8981;&#x8BA2;&#x9605;&#x7684; topic</p>
<p>String topic = &quot;test1&quot;;</p>
<p>// &#x8981;&#x67E5;&#x627E;&#x7684;&#x5206;&#x533A;</p>
<p>int partition = Integer.parseInt(&quot;0&quot;);</p>
<p>// broker &#x8282;&#x70B9;&#x7684; ip</p>
<p>List<string> seeds = new ArrayList&lt;&gt;();</string></p>
<p>seeds.add(&quot;192.168.9.102&quot;);</p>
<p>seeds.add(&quot;192.168.9.103&quot;);</p>
<p>seeds.add(&quot;192.168.9.104&quot;);</p>
<p>// &#x7AEF;&#x53E3;</p>
<p>int port = Integer.parseInt(&quot;9092&quot;);</p>
<p>try {</p>
<p>example.run(maxReads, topic, partition, seeds, port);</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(&quot;Oops:&quot; + e);</p>
<p>e.printStackTrace();</p>
<p>}</p>
<p>}</p>
<p>public void run(long a_maxReads, String a_topic, int a_partition, List<string> a_seedBrokers, int a_port) throws Exception {</string></p>
<p>// &#x83B7;&#x53D6;&#x6307;&#x5B9A; Topic partition &#x7684;&#x5143;&#x6570;&#x636E;</p>
<p>PartitionMetadata metadata = findLeader(a_seedBrokers, a_port, a_topic, a_partition);</p>
<p>if (metadata == null) {</p>
<p>System.out.println(&quot;Can&apos;t find metadata for Topic and Partition. Exiting&quot;);</p>
<p>return;</p>
<p>}</p>
<p>if (metadata.leader() == null) {</p>
<p>System.out.println(&quot;Can&apos;t find Leader for Topic and Partition. Exiting&quot;);</p>
<p>return;</p>
<p>}</p>
<p>String leadBroker = metadata.leader().host();</p>
<p>String clientName = &quot;Client<em>&quot; + a_topic + &quot;</em>&quot; + a_partition;</p>
<p>SimpleConsumer consumer = new SimpleConsumer(leadBroker, a_port, 100000, 64 * 1024, clientName);</p>
<p>long readOffset = getLastOffset(consumer, a_topic, a_partition, kafka.api.OffsetRequest.EarliestTime(), clientName);</p>
<p>int numErrors = 0;</p>
<p>while (a_maxReads &gt; 0) {</p>
<p>if (consumer == null) {</p>
<p>consumer = new SimpleConsumer(leadBroker, a_port, 100000, 64 * 1024, clientName);</p>
<p>}</p>
<p>FetchRequest req = new FetchRequestBuilder().clientId(clientName).addFetch(a_topic, a_partition, readOffset, 100000).build();</p>
<p>FetchResponse fetchResponse = consumer.fetch(req);</p>
<p>if (fetchResponse.hasError()) {</p>
<p>numErrors++;</p>
<p>// Something went wrong!</p>
<p>short code = fetchResponse.errorCode(a_topic, a_partition);</p>
<p>System.out.println(&quot;Error fetching data from the Broker:&quot; + leadBroker + &quot; Reason: &quot; + code);</p>
<p>if (numErrors &gt; 5)</p>
<p>break;</p>
<p>if (code == ErrorMapping.OffsetOutOfRangeCode()) {</p>
<p>// We asked for an invalid offset. For simple case ask for</p>
<p>// the last element to reset</p>
<p>readOffset = getLastOffset(consumer, a_topic, a_partition, kafka.api.OffsetRequest.LatestTime(), clientName);</p>
<p>continue;</p>
<p>}</p>
<p>consumer.close();</p>
<p>consumer = null;</p>
<p>leadBroker = findNewLeader(leadBroker, a_topic, a_partition, a_port);</p>
<p>continue;</p>
<p>}</p>
<p>numErrors = 0;</p>
<p>long numRead = 0;</p>
<p>for (MessageAndOffset messageAndOffset : fetchResponse.messageSet(a_topic, a_partition)) {</p>
<p>long currentOffset = messageAndOffset.offset();</p>
<p>if (currentOffset &lt; readOffset) {</p>
<p>System.out.println(&quot;Found an old offset: &quot; + currentOffset + &quot; Expecting: &quot; + readOffset);</p>
<p>continue;</p>
<p>}</p>
<p>readOffset = messageAndOffset.nextOffset();</p>
<p>ByteBuffer payload = messageAndOffset.message().payload();</p>
<p>byte[] bytes = new byte[payload.limit()];</p>
<p>payload.get(bytes);</p>
<p>System.out.println(String.valueOf(messageAndOffset.offset()) + &quot;: &quot; + new String(bytes, &quot;UTF-8&quot;));</p>
<p>numRead++;</p>
<p>a_maxReads--;</p>
<p>}</p>
<p>if (numRead == 0) {</p>
<p>try {</p>
<p>Thread.sleep(1000);</p>
<p>} catch (InterruptedException ie) {</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>if (consumer != null)</p>
<p>consumer.close();</p>
<p>}</p>
<p>public static long getLastOffset(SimpleConsumer consumer, String topic, int partition, long whichTime, String clientName) {</p>
<p>TopicAndPartition topicAndPartition = new TopicAndPartition(topic, partition);</p>
<p>Map<topicandpartition, partitionoffsetrequestinfo=""> requestInfo = new HashMap<topicandpartition, partitionoffsetrequestinfo="">();</topicandpartition,></topicandpartition,></p>
<p>requestInfo.put(topicAndPartition, new PartitionOffsetRequestInfo(whichTime, 1));</p>
<p>kafka.javaapi.OffsetRequest request = new kafka.javaapi.OffsetRequest(requestInfo, kafka.api.OffsetRequest.CurrentVersion(), clientName);</p>
<p>OffsetResponse response = consumer.getOffsetsBefore(request);</p>
<p>if (response.hasError()) {</p>
<p>System.out.println(&quot;Error fetching data Offset Data the Broker. Reason: &quot; + response.errorCode(topic, partition));</p>
<p>return 0;</p>
<p>}</p>
<p>long[] offsets = response.offsets(topic, partition);</p>
<p>return offsets[0];</p>
<p>}</p>
<p>private String findNewLeader(String a_oldLeader, String a_topic, int a_partition, int a_port) throws Exception {</p>
<p>for (int i = 0; i &lt; 3; i++) {</p>
<p>boolean goToSleep = false;</p>
<p>PartitionMetadata metadata = findLeader(m_replicaBrokers, a_port, a_topic, a_partition);</p>
<p>if (metadata == null) {</p>
<p>goToSleep = true;</p>
<p>} else if (metadata.leader() == null) {</p>
<p>goToSleep = true;</p>
<p>} else if (a_oldLeader.equalsIgnoreCase(metadata.leader().host()) &amp;&amp; i == 0) {</p>
<p>// first time through if the leader hasn&apos;t changed give</p>
<p>// ZooKeeper a second to recover</p>
<p>// second time, assume the broker did recover before failover,</p>
<p>// or it was a non-Broker issue</p>
<p>//</p>
<p>goToSleep = true;</p>
<p>} else {</p>
<p>return metadata.leader().host();</p>
<p>}</p>
<p>if (goToSleep) {</p>
<p>Thread.sleep(1000);</p>
<p>}</p>
<p>}</p>
<p>System.out.println(&quot;Unable to find new leader after Broker failure. Exiting&quot;);</p>
<p>throw new Exception(&quot;Unable to find new leader after Broker failure. Exiting&quot;);</p>
<p>}</p>
<p>private PartitionMetadata findLeader(List<string> a_seedBrokers, int a_port, String a_topic, int a_partition) {</string></p>
<p>PartitionMetadata returnMetaData = null;</p>
<p>loop:</p>
<p>for (String seed : a_seedBrokers) {</p>
<p>SimpleConsumer consumer = null;</p>
<p>try {</p>
<p>consumer = new SimpleConsumer(seed, a_port, 100000, 64 * 1024, &quot;leaderLookup&quot;);</p>
<p>List<string> topics = Collections.singletonList(a_topic);</string></p>
<p>TopicMetadataRequest req = new TopicMetadataRequest(topics);</p>
<p>kafka.javaapi.TopicMetadataResponse resp = consumer.send(req);</p>
<p>List<topicmetadata> metaData = resp.topicsMetadata();</topicmetadata></p>
<p>for (TopicMetadata item : metaData) {</p>
<p>for (PartitionMetadata part : item.partitionsMetadata()) {</p>
<p>if (part.partitionId() == a_partition) {</p>
<p>returnMetaData = part;</p>
<p>break loop;</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(&quot;Error communicating with Broker [&quot; + seed + &quot;] to find Leader for [&quot; + a_topic + &quot;, &quot; + a_partition + &quot;] Reason: &quot; + e);</p>
<p>} finally {</p>
<p>if (consumer != null)</p>
<p>consumer.close();</p>
<p>}</p>
<p>}</p>
<p>if (returnMetaData != null) {</p>
<p>m_replicaBrokers.clear();</p>
<p>for (BrokerEndPoint replica : returnMetaData.replicas()) {</p>
<p>m_replicaBrokers.add(replica.host());</p>
<p>}</p>
<p>}</p>
<p>return returnMetaData;</p>
<p>}</p>
<p>}</p>
<h1 id="5-kafka-producer-&#x62E6;&#x622A;&#x5668;interceptor">5. Kafka producer &#x62E6;&#x622A;&#x5668;(interceptor)</h1>
<h2 id="51-&#x62E6;&#x622A;&#x5668;&#x539F;&#x7406;">5.1 &#x62E6;&#x622A;&#x5668;&#x539F;&#x7406;</h2>
<p>Producer &#x62E6;&#x622A;&#x5668;(interceptor)&#x662F;&#x5728; Kafka 0.10 &#x7248;&#x672C;&#x88AB;&#x5F15;&#x5165;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5B9E;&#x73B0; clients &#x7AEF;&#x7684;&#x5B9A;&#x5236;&#x5316;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x3002;</p>
<p>&#x5BF9;&#x4E8E; producer &#x800C;&#x8A00;&#xFF0C;interceptor &#x4F7F;&#x5F97;&#x7528;&#x6237;&#x5728;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x524D;&#x4EE5;&#x53CA; producer &#x56DE;&#x8C03;&#x903B;&#x8F91;&#x524D;&#x6709;&#x673A;&#x4F1A;&#x5BF9;&#x6D88;&#x606F;&#x505A;&#x4E00;&#x4E9B;&#x5B9A;&#x5236;&#x5316;&#x9700;&#x6C42;&#xFF0C;&#x6BD4;&#x5982;&#x4FEE;&#x6539;&#x6D88;&#x606F;&#x7B49;&#x3002;&#x540C;&#x65F6;&#xFF0C;producer &#x5141;&#x8BB8;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x591A;&#x4E2A; interceptor &#x6309;&#x5E8F;&#x4F5C;&#x7528;&#x4E8E;&#x540C;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x4ECE;&#x800C;&#x5F62;&#x6210;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x94FE;(interceptor chain)&#x3002;Intercetpor &#x7684;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#x662F; org.apache.kafka.clients.producer.ProducerInterceptor&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x7684;&#x65B9;&#x6CD5;&#x5305;&#x62EC;&#xFF1A;</p>
<p>&#xFF08;1&#xFF09;configure(configs)</p>
<p>&#x83B7;&#x53D6;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x548C;&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x65F6;&#x8C03;&#x7528;&#x3002;</p>
<p>&#xFF08;2&#xFF09;onSend(ProducerRecord)&#xFF1A;</p>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x8FDB; KafkaProducer.send &#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5373;&#x5B83;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x3002;Producer &#x786E;&#x4FDD;&#x5728;&#x6D88;&#x606F;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x4EE5;&#x53CA;&#x8BA1;&#x7B97;&#x5206;&#x533A;&#x524D;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x5BF9;&#x6D88;&#x606F;&#x505A;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x6700;&#x597D;&#x4FDD;&#x8BC1;&#x4E0D;&#x8981;&#x4FEE;&#x6539;&#x6D88;&#x606F;&#x6240;&#x5C5E;&#x7684; topic &#x548C;&#x5206;&#x533A;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x5F71;&#x54CD;&#x76EE;&#x6807;&#x5206;&#x533A;&#x7684;&#x8BA1;&#x7B97;</p>
<p>&#xFF08;3&#xFF09;onAcknowledgement(RecordMetadata, Exception)&#xFF1A;</p>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x5728;&#x6D88;&#x606F;&#x88AB;&#x5E94;&#x7B54;&#x6216;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x5931;&#x8D25;&#x65F6;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x5728; producer &#x56DE;&#x8C03;&#x903B;&#x8F91;&#x89E6;&#x53D1;&#x4E4B;&#x524D;&#x3002;onAcknowledgement &#x8FD0;&#x884C;&#x5728; producer &#x7684; IO &#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x8981;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x653E;&#x5165;&#x5F88;&#x91CD;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x62D6;&#x6162; producer &#x7684;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x6548;&#x7387;</p>
<p>&#xFF08;4&#xFF09;close&#xFF1A;</p>
<p>&#x5173;&#x95ED; interceptor&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x8D44;&#x6E90;&#x6E05;&#x7406;&#x5DE5;&#x4F5C;</p>
<p>&#x5982;&#x524D;&#x6240;&#x8FF0;&#xFF0C;interceptor &#x53EF;&#x80FD;&#x88AB;&#x8FD0;&#x884C;&#x5728;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x65F6;&#x7528;&#x6237;&#x9700;&#x8981;&#x81EA;&#x884C;&#x786E;&#x4FDD;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x3002;&#x53E6;&#x5916;&#x5018;&#x82E5;&#x6307;&#x5B9A;&#x4E86;&#x591A;&#x4E2A; interceptor&#xFF0C;&#x5219; producer &#x5C06;&#x6309;&#x7167;&#x6307;&#x5B9A;&#x987A;&#x5E8F;&#x8C03;&#x7528;&#x5B83;&#x4EEC;&#xFF0C;&#x5E76;&#x4EC5;&#x4EC5;&#x662F;&#x6355;&#x83B7;&#x6BCF;&#x4E2A; interceptor &#x53EF;&#x80FD;&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;&#x8BB0;&#x5F55;&#x5230;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x4E2D;&#x800C;&#x975E;&#x5728;&#x5411;&#x4E0A;&#x4F20;&#x9012;&#x3002;&#x8FD9;&#x5728;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x8981;&#x7279;&#x522B;&#x7559;&#x610F;&#x3002;</p>
<p>5.2 &#x62E6;&#x622A;&#x5668;&#x6848;&#x4F8B;</p>
<p>1&#xFF09;&#x9700;&#x6C42;&#xFF1A;</p>
<p>&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x53CC; interceptor &#x7EC4;&#x6210;&#x7684;&#x62E6;&#x622A;&#x94FE;&#x3002;&#x7B2C;&#x4E00;&#x4E2A; interceptor &#x4F1A;&#x5728;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x524D;&#x5C06;&#x65F6;&#x95F4;&#x6233;&#x4FE1;&#x606F;&#x52A0;&#x5230;&#x6D88;&#x606F; value &#x7684;&#x6700;&#x524D;&#x90E8;&#xFF1B;&#x7B2C;&#x4E8C;&#x4E2A; interceptor &#x4F1A;&#x5728;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x540E;&#x66F4;&#x65B0;&#x6210;&#x529F;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x6570;&#x6216;&#x5931;&#x8D25;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x6570;&#x3002;</p>
<p>2&#xFF09;&#x6848;&#x4F8B;&#x5B9E;&#x64CD;</p>
<p>&#xFF08;1&#xFF09;&#x589E;&#x52A0;&#x65F6;&#x95F4;&#x6233;&#x62E6;&#x622A;&#x5668;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerInterceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">RecordMetadata</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">ProducerInterceptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> configs<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">onSend</span><span class="token punctuation">(</span><span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684; record&#xFF0C;&#x628A;&#x65F6;&#x95F4;&#x6233;&#x5199;&#x5165;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x6700;&#x524D;&#x90E8;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAcknowledgement</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#xFF08;2&#xFF09;&#x7EDF;&#x8BA1;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x6210;&#x529F;&#x548C;&#x53D1;&#x9001;&#x5931;&#x8D25;&#x6D88;&#x606F;&#x6570;&#xFF0C;&#x5E76;&#x5728; producer &#x5173;&#x95ED;&#x65F6;&#x6253;&#x5370;&#x8FD9;&#x4E24;&#x4E2A;&#x8BA1;&#x6570;&#x5668;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerInterceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">RecordMetadata</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CounterInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">ProducerInterceptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> errorCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> successCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> configs<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">onSend</span><span class="token punctuation">(</span><span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">record</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAcknowledgement</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// &#x7EDF;&#x8BA1;&#x6210;&#x529F;&#x548C;&#x5931;&#x8D25;&#x7684;&#x6B21;&#x6570;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                successCounter<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                errorCounter<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// &#x4FDD;&#x5B58;&#x7ED3;&#x679C;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Successful sent: &quot;</span> <span class="token operator">+</span> successCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Failed sent: &quot;</span> <span class="token operator">+</span> errorCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
&#xFF08;<span class="token number">3</span>&#xFF09;producer &#x4E3B;&#x7A0B;&#x5E8F;
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterceptorProducer</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1 &#x8BBE;&#x7F6E;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</span>
    <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop102:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;retries&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;batch.size&quot;</span><span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;linger.ms&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;buffer.memory&quot;</span><span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2 &#x6784;&#x5EFA;&#x62E6;&#x622A;&#x94FE;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> interceptors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.kafka.interceptor.TimeInterceptor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.kafka.interceptor.CounterInterceptor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span>INTERCEPTOR_CLASSES_CONFIG<span class="token punctuation">,</span> interceptors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token string">&quot;first&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3 &#x53D1;&#x9001;&#x6D88;&#x606F;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">record</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token comment">// 4 &#x4E00;&#x5B9A;&#x8981;&#x5173;&#x95ED; producer&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x4F1A;&#x8C03;&#x7528; interceptor &#x7684; close &#x65B9;&#x6CD5;</span>

    producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3&#xFF09;&#x6D4B;&#x8BD5;
&#xFF08;1&#xFF09;&#x5728; kafka &#x4E0A;&#x542F;&#x52A8;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x5BA2;&#x6237;&#x7AEF; java &#x7A0B;&#x5E8F;&#x3002;</p>
<pre class="language-"><code class="lang-plain">bin/kafka-console-consumer.sh \
--zookeeper hadoop102:2181 --from-beginning --topic first
</code></pre>
<p>1501904047034,message0</p>
<p>1501904047225,message1</p>
<p>1501904047230,message2</p>
<p>1501904047234,message3</p>
<p>1501904047236,message4</p>
<p>1501904047240,message5</p>
<p>1501904047243,message6</p>
<p>1501904047246,message7</p>
<p>1501904047249,message8</p>
<p>1501904047252,message9</p>
<p>&#xFF08;2&#xFF09;&#x89C2;&#x5BDF; java &#x5E73;&#x53F0;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>Successful sent: 10</p>
<p>Failed sent: 0</p>
<h1 id="6-kafka-&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x5206;&#x6790;">6. Kafka &#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x5206;&#x6790;</h1>
<h2 id="31-kafka-&#x751F;&#x4EA7;&#x8FC7;&#x7A0B;&#x5206;&#x6790;">3.1 Kafka &#x751F;&#x4EA7;&#x8FC7;&#x7A0B;&#x5206;&#x6790;</h2>
<h3 id="311-&#x5199;&#x5165;&#x65B9;&#x5F0F;">3.1.1 &#x5199;&#x5165;&#x65B9;&#x5F0F;</h3>
<p>producer &#x91C7;&#x7528;&#x63A8;&#xFF08;push&#xFF09;&#x6A21;&#x5F0F;&#x5C06;&#x6D88;&#x606F;&#x53D1;&#x5E03;&#x5230; broker&#xFF0C;&#x6BCF;&#x6761;&#x6D88;&#x606F;&#x90FD;&#x88AB;&#x8FFD;&#x52A0;&#xFF08;append&#xFF09;&#x5230;&#x5206;&#x533A;&#xFF08;patition&#xFF09;&#x4E2D;&#xFF0C;&#x5C5E;&#x4E8E;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#xFF08;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#x6548;&#x7387;&#x6BD4;&#x968F;&#x673A;&#x5199;&#x5185;&#x5B58;&#x8981;&#x9AD8;&#xFF0C;&#x4FDD;&#x969C; kafka &#x541E;&#x5410;&#x7387;&#xFF09;&#x3002;</p>
<h3 id="312-&#x5206;&#x533A;&#xFF08;partition&#xFF09;">3.1.2 &#x5206;&#x533A;&#xFF08;Partition&#xFF09;</h3>
<p>&#x6D88;&#x606F;&#x53D1;&#x9001;&#x65F6;&#x90FD;&#x88AB;&#x53D1;&#x9001;&#x5230;&#x4E00;&#x4E2A; topic&#xFF0C;&#x5176;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x800C; topic &#x662F;&#x7531;&#x4E00;&#x4E9B; Partition Logs(&#x5206;&#x533A;&#x65E5;&#x5FD7;)&#x7EC4;&#x6210;&#xFF0C;&#x5176;&#x7EC4;&#x7EC7;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/HVeCE3bMylHfgvKz.png!thumbnail?fileGuid=kcDQJ8PgC8thg6gD" alt="&#x56FE;&#x7247;"></p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6BCF;&#x4E2A; Partition &#x4E2D;&#x7684;&#x6D88;&#x606F;&#x90FD;&#x662F;&#x6709;&#x5E8F;&#x7684;&#xFF0C;&#x751F;&#x4EA7;&#x7684;&#x6D88;&#x606F;&#x88AB;&#x4E0D;&#x65AD;&#x8FFD;&#x52A0;&#x5230; Partition log &#x4E0A;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x90FD;&#x88AB;&#x8D4B;&#x4E88;&#x4E86;&#x4E00;&#x4E2A;&#x552F;&#x4E00;&#x7684; offset &#x503C;&#x3002;</p>
<p>1&#xFF09;&#x5206;&#x533A;&#x7684;&#x539F;&#x56E0;</p>
<p>&#xFF08;1&#xFF09;&#x65B9;&#x4FBF;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x6269;&#x5C55;&#xFF0C;&#x6BCF;&#x4E2A; Partition &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x6574;&#x4EE5;&#x9002;&#x5E94;&#x5B83;&#x6240;&#x5728;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x800C;&#x4E00;&#x4E2A; topic &#x53C8;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A; Partition &#x7EC4;&#x6210;&#xFF0C;&#x56E0;&#x6B64;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x5C31;&#x53EF;&#x4EE5;&#x9002;&#x5E94;&#x4EFB;&#x610F;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x4E86;&#xFF1B;</p>
<p>&#xFF08;2&#xFF09;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5E76;&#x53D1;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x4EE5;&#x4EE5; Partition &#x4E3A;&#x5355;&#x4F4D;&#x8BFB;&#x5199;&#x4E86;&#x3002;</p>
<p>2&#xFF09;&#x5206;&#x533A;&#x7684;&#x539F;&#x5219;</p>
<p>&#xFF08;1&#xFF09;&#x6307;&#x5B9A;&#x4E86; patition&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF1B;</p>
<p>&#xFF08;2&#xFF09;&#x672A;&#x6307;&#x5B9A; patition &#x4F46;&#x6307;&#x5B9A; key&#xFF0C;&#x901A;&#x8FC7;&#x5BF9; key &#x7684; value &#x8FDB;&#x884C; hash &#x51FA;&#x4E00;&#x4E2A; patition&#xFF1B;</p>
<p>&#xFF08;3&#xFF09;patition &#x548C; key &#x90FD;&#x672A;&#x6307;&#x5B9A;&#xFF0C;&#x4F7F;&#x7528;&#x8F6E;&#x8BE2;&#x9009;&#x51FA;&#x4E00;&#x4E2A; patition&#x3002;</p>
<p>DefaultPartitioner &#x7C7B;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keyBytes<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> valueBytes<span class="token punctuation">,</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartitionInfo</span><span class="token punctuation">&gt;</span></span> partitions <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">partitionsForTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> numPartitions <span class="token operator">=</span> partitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>keyBytes <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> nextValue <span class="token operator">=</span> <span class="token function">nextValue</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartitionInfo</span><span class="token punctuation">&gt;</span></span> availablePartitions <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">availablePartitionsForTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>availablePartitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> part <span class="token operator">=</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">toPositive</span><span class="token punctuation">(</span>nextValue<span class="token punctuation">)</span> <span class="token operator">%</span> availablePartitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> availablePartitions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// no partitions are available, give a non-available partition</span>
                <span class="token keyword">return</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">toPositive</span><span class="token punctuation">(</span>nextValue<span class="token punctuation">)</span> <span class="token operator">%</span> numPartitions<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// hash the keyBytes to choose a partition</span>
            <span class="token keyword">return</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">toPositive</span><span class="token punctuation">(</span><span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">murmur2</span><span class="token punctuation">(</span>keyBytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> numPartitions<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3 id="313-&#x526F;&#x672C;&#xFF08;replication&#xFF09;">3.1.3 &#x526F;&#x672C;&#xFF08;Replication&#xFF09;</h3>
<p>&#x540C;&#x4E00;&#x4E2A; partition &#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x591A;&#x4E2A; replication&#xFF08;&#x5BF9;&#x5E94; server.properties &#x914D;&#x7F6E;&#x4E2D;&#x7684; default.replication.factor=N&#xFF09;&#x3002;&#x6CA1;&#x6709; replication &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x65E6; broker &#x5B95;&#x673A;&#xFF0C;&#x5176;&#x4E0A;&#x6240;&#x6709; patition &#x7684;&#x6570;&#x636E;&#x90FD;&#x4E0D;&#x53EF;&#x88AB;&#x6D88;&#x8D39;&#xFF0C;&#x540C;&#x65F6; producer &#x4E5F;&#x4E0D;&#x80FD;&#x518D;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x4E8E;&#x5176;&#x4E0A;&#x7684; patition&#x3002;&#x5F15;&#x5165; replication &#x4E4B;&#x540E;&#xFF0C;&#x540C;&#x4E00;&#x4E2A; partition &#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x591A;&#x4E2A; replication&#xFF0C;&#x800C;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x5728;&#x8FD9;&#x4E9B; replication &#x4E4B;&#x95F4;&#x9009;&#x51FA;&#x4E00;&#x4E2A; leader&#xFF0C;producer &#x548C; consumer &#x53EA;&#x4E0E;&#x8FD9;&#x4E2A; leader &#x4EA4;&#x4E92;&#xFF0C;&#x5176;&#x5B83; replication &#x4F5C;&#x4E3A; follower &#x4ECE; leader &#x4E2D;&#x590D;&#x5236;&#x6570;&#x636E;&#x3002;</p>
<h3 id="314-&#x5199;&#x5165;&#x6D41;&#x7A0B;">3.1.4 &#x5199;&#x5165;&#x6D41;&#x7A0B;</h3>
<p>producer &#x5199;&#x5165;&#x6D88;&#x606F;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/BFtvqNLWWq27FHdY.png!thumbnail?fileGuid=kcDQJ8PgC8thg6gD" alt="&#x56FE;&#x7247;"></p>
<p>1&#xFF09;producer &#x5148;&#x4ECE; zookeeper &#x7684; &quot;/brokers/.../state&quot;&#x8282;&#x70B9;&#x627E;&#x5230;&#x8BE5; partition &#x7684; leader</p>
<p>2&#xFF09;producer &#x5C06;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x7ED9;&#x8BE5; leader</p>
<p>3&#xFF09;leader &#x5C06;&#x6D88;&#x606F;&#x5199;&#x5165;&#x672C;&#x5730; log</p>
<p>4&#xFF09;followers &#x4ECE; leader pull &#x6D88;&#x606F;&#xFF0C;&#x5199;&#x5165;&#x672C;&#x5730; log &#x540E;&#x5411; leader &#x53D1;&#x9001; ACK</p>
<p>5&#xFF09;leader &#x6536;&#x5230;&#x6240;&#x6709; ISR &#x4E2D;&#x7684; replication &#x7684; ACK &#x540E;&#xFF0C;&#x589E;&#x52A0; HW&#xFF08;high watermark&#xFF0C;&#x6700;&#x540E; commit &#x7684; offset&#xFF09;&#x5E76;&#x5411; producer &#x53D1;&#x9001; ACK</p>
<h2 id="32-broker-&#x4FDD;&#x5B58;&#x6D88;&#x606F;">3.2 Broker &#x4FDD;&#x5B58;&#x6D88;&#x606F;</h2>
<h3 id="321-&#x5B58;&#x50A8;&#x65B9;&#x5F0F;">3.2.1 &#x5B58;&#x50A8;&#x65B9;&#x5F0F;</h3>
<p>&#x7269;&#x7406;&#x4E0A;&#x628A; topic &#x5206;&#x6210;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A; patition&#xFF08;&#x5BF9;&#x5E94; server.properties &#x4E2D;&#x7684; num.partitions=3 &#x914D;&#x7F6E;&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A; patition &#x7269;&#x7406;&#x4E0A;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF08;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x5B58;&#x50A8;&#x8BE5; patition &#x7684;&#x6240;&#x6709;&#x6D88;&#x606F;&#x548C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#xFF09;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-plain">ll
</code></pre>
<p>drwxrwxr-x. 2 atguigu atguigu  4096 8 &#x6708;   6 14:37 first-0
drwxrwxr-x. 2 atguigu atguigu  4096 8 &#x6708;   6 14:35 first-1</p>
<p>drwxrwxr-x. 2 atguigu atguigu  4096 8 &#x6708;   6 14:37 first-2</p>
<pre class="language-"><code class="lang-plain"> cd first-0
 ll
</code></pre>
<p>-rw-rw-r--. 1 atguigu atguigu 10485760 8 &#x6708;   6 14:33 00000000000000000000.index
-rw-rw-r--. 1 atguigu atguigu      219 8 &#x6708;   6 15:07 00000000000000000000.log</p>
<p>-rw-rw-r--. 1 atguigu atguigu 10485756 8 &#x6708;   6 14:33 00000000000000000000.timeindex</p>
<p>-rw-rw-r--. 1 atguigu atguigu        8 8 &#x6708;   6 14:37 leader-epoch-checkpoint</p>
<h3 id="322-&#x5B58;&#x50A8;&#x7B56;&#x7565;">3.2.2 &#x5B58;&#x50A8;&#x7B56;&#x7565;</h3>
<p>&#x65E0;&#x8BBA;&#x6D88;&#x606F;&#x662F;&#x5426;&#x88AB;&#x6D88;&#x8D39;&#xFF0C;kafka &#x90FD;&#x4F1A;&#x4FDD;&#x7559;&#x6240;&#x6709;&#x6D88;&#x606F;&#x3002;&#x6709;&#x4E24;&#x79CD;&#x7B56;&#x7565;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x65E7;&#x6570;&#x636E;&#xFF1A;</p>
<p>1&#xFF09;&#x57FA;&#x4E8E;&#x65F6;&#x95F4;&#xFF1A;log.retention.hours=168</p>
<p>2&#xFF09;&#x57FA;&#x4E8E;&#x5927;&#x5C0F;&#xFF1A;log.retention.bytes=1073741824</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x56E0;&#x4E3A; Kafka &#x8BFB;&#x53D6;&#x7279;&#x5B9A;&#x6D88;&#x606F;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A; O(1)&#xFF0C;&#x5373;&#x4E0E;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x65E0;&#x5173;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5220;&#x9664;&#x8FC7;&#x671F;&#x6587;&#x4EF6;&#x4E0E;&#x63D0;&#x9AD8; Kafka &#x6027;&#x80FD;&#x65E0;&#x5173;&#x3002;</p>
<h3 id="323-zookeeper-&#x5B58;&#x50A8;&#x7ED3;&#x6784;">3.2.3 Zookeeper &#x5B58;&#x50A8;&#x7ED3;&#x6784;</h3>
<p><img src="https://uploader.shimo.im/f/LJHbLV2V6KkRoJt8.png!thumbnail?fileGuid=kcDQJ8PgC8thg6gD" alt="&#x56FE;&#x7247;"></p>
<p>&#x6CE8;&#x610F;&#xFF1A;producer &#x4E0D;&#x5728; zk &#x4E2D;&#x6CE8;&#x518C;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x5728; zk &#x4E2D;&#x6CE8;&#x518C;&#x3002;</p>
<h2 id="33-kafka-&#x6D88;&#x8D39;&#x8FC7;&#x7A0B;&#x5206;&#x6790;">3.3 Kafka &#x6D88;&#x8D39;&#x8FC7;&#x7A0B;&#x5206;&#x6790;</h2>
<p>kafka &#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x5957; consumer API&#xFF1A;&#x9AD8;&#x7EA7; Consumer API &#x548C;&#x4F4E;&#x7EA7; Consumer API&#x3002;</p>
<h3 id="331-&#x9AD8;&#x7EA7;-api">3.3.1 &#x9AD8;&#x7EA7; API</h3>
<p>1&#xFF09;&#x9AD8;&#x7EA7; API &#x4F18;&#x70B9;</p>
<p>&#x9AD8;&#x7EA7; API &#x5199;&#x8D77;&#x6765;&#x7B80;&#x5355;</p>
<p>&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x884C;&#x53BB;&#x7BA1;&#x7406; offset&#xFF0C;&#x7CFB;&#x7EDF;&#x901A;&#x8FC7; zookeeper &#x81EA;&#x884C;&#x7BA1;&#x7406;&#x3002;</p>
<p>&#x4E0D;&#x9700;&#x8981;&#x7BA1;&#x7406;&#x5206;&#x533A;&#xFF0C;&#x526F;&#x672C;&#x7B49;&#x60C5;&#x51B5;&#xFF0C;.&#x7CFB;&#x7EDF;&#x81EA;&#x52A8;&#x7BA1;&#x7406;&#x3002;</p>
<p>&#x6D88;&#x8D39;&#x8005;&#x65AD;&#x7EBF;&#x4F1A;&#x81EA;&#x52A8;&#x6839;&#x636E;&#x4E0A;&#x4E00;&#x6B21;&#x8BB0;&#x5F55;&#x5728; zookeeper &#x4E2D;&#x7684; offset &#x53BB;&#x63A5;&#x7740;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF08;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E; 1 &#x5206;&#x949F;&#x66F4;&#x65B0;&#x4E00;&#x4E0B; zookeeper &#x4E2D;&#x5B58;&#x7684; offset&#xFF09;</p>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; group &#x6765;&#x533A;&#x5206;&#x5BF9;&#x540C;&#x4E00;&#x4E2A; topic &#x7684;&#x4E0D;&#x540C;&#x7A0B;&#x5E8F;&#x8BBF;&#x95EE;&#x5206;&#x79BB;&#x5F00;&#x6765;&#xFF08;&#x4E0D;&#x540C;&#x7684; group &#x8BB0;&#x5F55;&#x4E0D;&#x540C;&#x7684; offset&#xFF0C;&#x8FD9;&#x6837;&#x4E0D;&#x540C;&#x7A0B;&#x5E8F;&#x8BFB;&#x53D6;&#x540C;&#x4E00;&#x4E2A; topic &#x624D;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A; offset &#x4E92;&#x76F8;&#x5F71;&#x54CD;&#xFF09;</p>
<p>2&#xFF09;&#x9AD8;&#x7EA7; API &#x7F3A;&#x70B9;</p>
<p>&#x4E0D;&#x80FD;&#x81EA;&#x884C;&#x63A7;&#x5236; offset&#xFF08;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x9700;&#x6C42;&#x6765;&#x8BF4;&#xFF09;</p>
<p>&#x4E0D;&#x80FD;&#x7EC6;&#x5316;&#x63A7;&#x5236;&#x5982;&#x5206;&#x533A;&#x3001;&#x526F;&#x672C;&#x3001;zk &#x7B49;</p>
<h3 id="332-&#x4F4E;&#x7EA7;-api">3.3.2 &#x4F4E;&#x7EA7; API</h3>
<p>1&#xFF09;&#x4F4E;&#x7EA7; API &#x4F18;&#x70B9;</p>
<p>&#x80FD;&#x591F;&#x8BA9;&#x5F00;&#x53D1;&#x8005;&#x81EA;&#x5DF1;&#x63A7;&#x5236; offset&#xFF0C;&#x60F3;&#x4ECE;&#x54EA;&#x91CC;&#x8BFB;&#x53D6;&#x5C31;&#x4ECE;&#x54EA;&#x91CC;&#x8BFB;&#x53D6;&#x3002;</p>
<p>&#x81EA;&#x884C;&#x63A7;&#x5236;&#x8FDE;&#x63A5;&#x5206;&#x533A;&#xFF0C;&#x5BF9;&#x5206;&#x533A;&#x81EA;&#x5B9A;&#x4E49;&#x8FDB;&#x884C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</p>
<p>&#x5BF9; zookeeper &#x7684;&#x4F9D;&#x8D56;&#x6027;&#x964D;&#x4F4E;&#xFF08;&#x5982;&#xFF1A;offset &#x4E0D;&#x4E00;&#x5B9A;&#x975E;&#x8981;&#x9760; zk &#x5B58;&#x50A8;&#xFF0C;&#x81EA;&#x884C;&#x5B58;&#x50A8; offset &#x5373;&#x53EF;&#xFF0C;&#x6BD4;&#x5982;&#x5B58;&#x5728;&#x6587;&#x4EF6;&#x6216;&#x8005;&#x5185;&#x5B58;&#x4E2D;&#xFF09;</p>
<p>2&#xFF09;&#x4F4E;&#x7EA7; API &#x7F3A;&#x70B9;</p>
<p>&#x592A;&#x8FC7;&#x590D;&#x6742;&#xFF0C;&#x9700;&#x8981;&#x81EA;&#x884C;&#x63A7;&#x5236; offset&#xFF0C;&#x8FDE;&#x63A5;&#x54EA;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x627E;&#x5230;&#x5206;&#x533A; leader &#x7B49;&#x3002;</p>
<h3 id="333-&#x6D88;&#x8D39;&#x8005;&#x7EC4;">3.3.3 &#x6D88;&#x8D39;&#x8005;&#x7EC4;</h3>
<p><img src="https://uploader.shimo.im/f/REeY5GiBJ8zYVFeM.png!thumbnail?fileGuid=kcDQJ8PgC8thg6gD" alt="&#x56FE;&#x7247;"></p>
<p>&#x6D88;&#x8D39;&#x8005;&#x662F;&#x4EE5; consumer group &#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x7684;&#x65B9;&#x5F0F;&#x5DE5;&#x4F5C;&#xFF0C;&#x7531;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x7EC4;&#xFF0C;&#x5171;&#x540C;&#x6D88;&#x8D39;&#x4E00;&#x4E2A; topic&#x3002;&#x6BCF;&#x4E2A;&#x5206;&#x533A;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EA;&#x80FD;&#x7531; group &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x8BFB;&#x53D6;&#xFF0C;&#x4F46;&#x662F;&#x591A;&#x4E2A; group &#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x6D88;&#x8D39;&#x8FD9;&#x4E2A; partition&#x3002;&#x5728;&#x56FE;&#x4E2D;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x7531;&#x4E09;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x6210;&#x7684; group&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x8BFB;&#x53D6;&#x4E3B;&#x9898;&#x4E2D;&#x7684;&#x4E24;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x5206;&#x522B;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x3002;&#x67D0;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x8BFB;&#x53D6;&#x67D0;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53EB;&#x505A;&#x67D0;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x662F;&#x67D0;&#x4E2A;&#x5206;&#x533A;&#x7684;&#x62E5;&#x6709;&#x8005;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6C34;&#x5E73;&#x6269;&#x5C55;&#x7684;&#x65B9;&#x5F0F;&#x540C;&#x65F6;&#x8BFB;&#x53D6;&#x5927;&#x91CF;&#x7684;&#x6D88;&#x606F;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x4ED6;&#x7684; group &#x6210;&#x5458;&#x4F1A;&#x81EA;&#x52A8;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x8BFB;&#x53D6;&#x4E4B;&#x524D;&#x5931;&#x8D25;&#x7684;&#x6D88;&#x8D39;&#x8005;&#x8BFB;&#x53D6;&#x7684;&#x5206;&#x533A;&#x3002;</p>
<h3 id="334-&#x6D88;&#x8D39;&#x65B9;&#x5F0F;">3.3.4 &#x6D88;&#x8D39;&#x65B9;&#x5F0F;</h3>
<p>consumer &#x91C7;&#x7528; pull&#xFF08;&#x62C9;&#xFF09;&#x6A21;&#x5F0F;&#x4ECE; broker &#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;</p>
<p>push&#xFF08;&#x63A8;&#xFF09;&#x6A21;&#x5F0F;&#x5F88;&#x96BE;&#x9002;&#x5E94;&#x6D88;&#x8D39;&#x901F;&#x7387;&#x4E0D;&#x540C;&#x7684;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x56E0;&#x4E3A;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x901F;&#x7387;&#x662F;&#x7531; broker &#x51B3;&#x5B9A;&#x7684;&#x3002;&#x5B83;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5C3D;&#x53EF;&#x80FD;&#x4EE5;&#x6700;&#x5FEB;&#x901F;&#x5EA6;&#x4F20;&#x9012;&#x6D88;&#x606F;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x5F88;&#x5BB9;&#x6613;&#x9020;&#x6210; consumer &#x6765;&#x4E0D;&#x53CA;&#x5904;&#x7406;&#x6D88;&#x606F;&#xFF0C;&#x5178;&#x578B;&#x7684;&#x8868;&#x73B0;&#x5C31;&#x662F;&#x62D2;&#x7EDD;&#x670D;&#x52A1;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x62E5;&#x585E;&#x3002;&#x800C; pull &#x6A21;&#x5F0F;&#x5219;&#x53EF;&#x4EE5;&#x6839;&#x636E; consumer &#x7684;&#x6D88;&#x8D39;&#x80FD;&#x529B;&#x4EE5;&#x9002;&#x5F53;&#x7684;&#x901F;&#x7387;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x3002;</p>
<p>&#x5BF9;&#x4E8E; Kafka &#x800C;&#x8A00;&#xFF0C;pull &#x6A21;&#x5F0F;&#x66F4;&#x5408;&#x9002;&#xFF0C;&#x5B83;&#x53EF;&#x7B80;&#x5316; broker &#x7684;&#x8BBE;&#x8BA1;&#xFF0C;consumer &#x53EF;&#x81EA;&#x4E3B;&#x63A7;&#x5236;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;&#x901F;&#x7387;&#xFF0C;&#x540C;&#x65F6; consumer &#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x63A7;&#x5236;&#x6D88;&#x8D39;&#x65B9;&#x5F0F;&#x2014;&#x2014;&#x5373;&#x53EF;&#x6279;&#x91CF;&#x6D88;&#x8D39;&#x4E5F;&#x53EF;&#x9010;&#x6761;&#x6D88;&#x8D39;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x80FD;&#x9009;&#x62E9;&#x4E0D;&#x540C;&#x7684;&#x63D0;&#x4EA4;&#x65B9;&#x5F0F;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x4F20;&#x8F93;&#x8BED;&#x4E49;&#x3002;</p>
<p>pull &#x6A21;&#x5F0F;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x662F;&#xFF0C;&#x5982;&#x679C; kafka &#x6CA1;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x53EF;&#x80FD;&#x4F1A;&#x9677;&#x5165;&#x5FAA;&#x73AF;&#x4E2D;&#xFF0C;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x5230;&#x8FBE;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x62C9;&#x8BF7;&#x6C42;&#x4E2D;&#x6709;&#x53C2;&#x6570;&#xFF0C;&#x5141;&#x8BB8;&#x6D88;&#x8D39;&#x8005;&#x8BF7;&#x6C42;&#x5728;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x5230;&#x8FBE;&#x7684;&#x201C;&#x957F;&#x8F6E;&#x8BE2;&#x201D;&#x4E2D;&#x8FDB;&#x884C;&#x963B;&#x585E;&#xFF08;&#x5E76;&#x4E14;&#x53EF;&#x9009;&#x5730;&#x7B49;&#x5F85;&#x5230;&#x7ED9;&#x5B9A;&#x7684;&#x5B57;&#x8282;&#x6570;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x5927;&#x7684;&#x4F20;&#x8F93;&#x5927;&#x5C0F;&#xFF09;&#x3002;</p>
<h3 id="335-&#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x6848;&#x4F8B;">3.3.5 &#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x6848;&#x4F8B;</h3>
<p>1&#xFF09;&#x9700;&#x6C42;&#xFF1A;&#x6D4B;&#x8BD5;&#x540C;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x7EC4;&#x4E2D;&#x7684;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x3002;</p>
<p>2&#xFF09;&#x6848;&#x4F8B;&#x5B9E;&#x64CD;</p>
<p>&#xFF08;1&#xFF09;&#x5728; hadoop102&#x3001;hadoop103 &#x4E0A;&#x4FEE;&#x6539;/opt/module/kafka/config/consumer.properties &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684; group.id &#x5C5E;&#x6027;&#x4E3A;&#x4EFB;&#x610F;&#x7EC4;&#x540D;&#x3002;</p>
<pre class="language-"><code class="lang-plain">vi consumer.properties
</code></pre>
<p>group.id=atguigu
&#xFF08;2&#xFF09;&#x5728; hadoop102&#x3001;hadoop103 &#x4E0A;&#x5206;&#x522B;&#x542F;&#x52A8;&#x6D88;&#x8D39;&#x8005;</p>
<pre class="language-"><code class="lang-plain">bin/kafka-console-consumer.sh \
--zookeeper hadoop102:2181 --topic first --consumer.config config/consumer.properties
bin/kafka-console-consumer.sh --zookeeper hadoop102:2181 --topic first --consumer.config config/consumer.properties
</code></pre>
<p>&#xFF08;3&#xFF09;&#x5728; hadoop104 &#x4E0A;&#x542F;&#x52A8;&#x751F;&#x4EA7;&#x8005;</p>
<pre class="language-"><code class="lang-plain">bin/kafka-console-producer.sh \
--broker-list hadoop102:9092 --topic first
&gt;hello world
</code></pre>
<p>&#xFF08;4&#xFF09;&#x67E5;&#x770B; hadoop102 &#x548C; hadoop103 &#x7684;&#x63A5;&#x6536;&#x8005;&#x3002;
&#x540C;&#x4E00;&#x65F6;&#x523B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x3002;</p>
<h1 id="7-&#x6269;&#x5C55;">7. &#x6269;&#x5C55;</h1>
<h2 id="71-kafka-&#x4E0E;-flume-&#x6BD4;&#x8F83;">7.1 Kafka &#x4E0E; Flume &#x6BD4;&#x8F83;</h2>
<p>&#x5728;&#x4F01;&#x4E1A;&#x4E2D;&#x5FC5;&#x987B;&#x8981;&#x6E05;&#x695A;&#x6D41;&#x5F0F;&#x6570;&#x636E;&#x91C7;&#x96C6;&#x6846;&#x67B6; flume &#x548C; kafka &#x7684;&#x5B9A;&#x4F4D;&#x662F;&#x4EC0;&#x4E48;&#xFF1A;</p>
<p>flume&#xFF1A;cloudera &#x516C;&#x53F8;&#x7814;&#x53D1;:</p>
<p>&#x9002;&#x5408;&#x591A;&#x4E2A;&#x751F;&#x4EA7;&#x8005;&#xFF1B;</p>
<p>&#x9002;&#x5408;&#x4E0B;&#x6E38;&#x6570;&#x636E;&#x6D88;&#x8D39;&#x8005;&#x4E0D;&#x591A;&#x7684;&#x60C5;&#x51B5;&#xFF1B;</p>
<p>&#x9002;&#x5408;&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;&#x8981;&#x6C42;&#x4E0D;&#x9AD8;&#x7684;&#x64CD;&#x4F5C;&#xFF1B;</p>
<p>&#x9002;&#x5408;&#x4E0E; Hadoop &#x751F;&#x6001;&#x5708;&#x5BF9;&#x63A5;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p>kafka&#xFF1A;linkedin &#x516C;&#x53F8;&#x7814;&#x53D1;:</p>
<p>&#x9002;&#x5408;&#x6570;&#x636E;&#x4E0B;&#x6E38;&#x6D88;&#x8D39;&#x4F17;&#x591A;&#x7684;&#x60C5;&#x51B5;&#xFF1B;</p>
<p>&#x9002;&#x5408;&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;&#x8981;&#x6C42;&#x8F83;&#x9AD8;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x652F;&#x6301; replication&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5E38;&#x7528;&#x7684;&#x4E00;&#x79CD;&#x6A21;&#x578B;&#x662F;&#xFF1A;</p>
<p>&#x7EBF;&#x4E0A;&#x6570;&#x636E; --&gt; flume --&gt; kafka --&gt; flume(&#x6839;&#x636E;&#x60C5;&#x666F;&#x589E;&#x5220;&#x8BE5;&#x6D41;&#x7A0B;) --&gt; HDFS</p>
<h2 id="72-flume-&#x4E0E;-kafka-&#x96C6;&#x6210;">7.2 Flume &#x4E0E; kafka &#x96C6;&#x6210;</h2>
<p>1&#xFF09;&#x914D;&#x7F6E; flume(flume-kafka.conf)</p>
<pre class="language-"><code class="lang-xml"># define
a1.sources = r1
a1.sinks = k1
a1.channels = c1
# source
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F -c +0 /opt/module/datas/flume.log
a1.sources.r1.shell = /bin/bash -c
# sink
a1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink
a1.sinks.k1.kafka.bootstrap.servers = hadoop102:9092,hadoop103:9092,hadoop104:9092
a1.sinks.k1.kafka.topic = first
a1.sinks.k1.kafka.flumeBatchSize = 20
a1.sinks.k1.kafka.producer.acks = 1
a1.sinks.k1.kafka.producer.linger.ms = 1
# channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100
# bind
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre>
<p>2&#xFF09; &#x542F;&#x52A8; kafkaIDEA &#x6D88;&#x8D39;&#x8005;
3&#xFF09; &#x8FDB;&#x5165; flume &#x6839;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x542F;&#x52A8; flume</p>
<pre class="language-"><code class="lang-plain"> bin/flume-ng agent -c conf/ -n a1 -f jobs/flume-kafka.conf
</code></pre>
<p>4&#xFF09; &#x5411; /opt/module/datas/flume.log &#x91CC;&#x8FFD;&#x52A0;&#x6570;&#x636E;&#xFF0C;&#x67E5;&#x770B; kafka &#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x60C5;&#x51B5;
$ echo hello &gt; /opt/module/datas</p>
<h2 id="73-kafka-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3 Kafka &#x914D;&#x7F6E;&#x4FE1;&#x606F;</h2>
<h3 id="731-broker-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3.1 Broker &#x914D;&#x7F6E;&#x4FE1;&#x606F;</h3>
<p>&#x5C5E;&#x6027;    &#x9ED8;&#x8BA4;&#x503C;    &#x63CF;&#x8FF0;</p>
<p>broker.id        &#x5FC5;&#x586B;&#x53C2;&#x6570;&#xFF0C;broker &#x7684;&#x552F;&#x4E00;&#x6807;&#x8BC6;</p>
<p>log.dirs    /tmp/kafka-logs    Kafka &#x6570;&#x636E;&#x5B58;&#x653E;&#x7684;&#x76EE;&#x5F55;&#x3002;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x4E2D;&#x95F4;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694;&#xFF0C;&#x5F53;&#x65B0; partition &#x88AB;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x4F1A;&#x88AB;&#x5B58;&#x653E;&#x5230;&#x5F53;&#x524D;&#x5B58;&#x653E; partition &#x6700;&#x5C11;&#x7684;&#x76EE;&#x5F55;&#x3002;</p>
<p>port    9092    BrokerServer &#x63A5;&#x53D7;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</p>
<p>zookeeper.connect    null    Zookeeper &#x7684;&#x8FDE;&#x63A5;&#x4E32;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;hostname1:port1,hostname2:port2,hostname3:port3&#x3002;&#x53EF;&#x4EE5;&#x586B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x53EF;&#x9760;&#x6027;&#xFF0C;&#x5EFA;&#x8BAE;&#x90FD;&#x586B;&#x4E0A;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x6B64;&#x914D;&#x7F6E;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x4E00;&#x4E2A; zookeeper &#x8DEF;&#x5F84;&#x6765;&#x5B58;&#x653E;&#x6B64; kafka &#x96C6;&#x7FA4;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x4E3A;&#x4E86;&#x4E0E;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x96C6;&#x7FA4;&#x533A;&#x5206;&#x5F00;&#xFF0C;&#x5EFA;&#x8BAE;&#x5728;&#x6B64;&#x914D;&#x7F6E;&#x4E2D;&#x6307;&#x5B9A;&#x672C;&#x96C6;&#x7FA4;&#x5B58;&#x653E;&#x76EE;&#x5F55;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;hostname1:port1,hostname2:port2,hostname3:port3/chroot/path&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x53C2;&#x6570;&#x8981;&#x548C;&#x6B64;&#x53C2;&#x6570;&#x4E00;&#x81F4;&#x3002;</p>
<p>message.max.bytes    1000000    &#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6700;&#x5927;&#x7684;&#x6D88;&#x606F;&#x5927;&#x5C0F;&#x3002;&#x6CE8;&#x610F;&#x6B64;&#x53C2;&#x6570;&#x8981;&#x548C; consumer &#x7684; maximum.message.size &#x5927;&#x5C0F;&#x4E00;&#x81F4;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x56E0;&#x4E3A;&#x751F;&#x4EA7;&#x8005;&#x751F;&#x4EA7;&#x7684;&#x6D88;&#x606F;&#x592A;&#x5927;&#x5BFC;&#x81F4;&#x6D88;&#x8D39;&#x8005;&#x65E0;&#x6CD5;&#x6D88;&#x8D39;&#x3002;</p>
<p>num.io.threads    8    &#x670D;&#x52A1;&#x5668;&#x7528;&#x6765;&#x6267;&#x884C;&#x8BFB;&#x5199;&#x8BF7;&#x6C42;&#x7684; IO &#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x6B64;&#x53C2;&#x6570;&#x7684;&#x6570;&#x91CF;&#x81F3;&#x5C11;&#x8981;&#x7B49;&#x4E8E;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x78C1;&#x76D8;&#x7684;&#x6570;&#x91CF;&#x3002;</p>
<p>queued.max.requests    500    I/O &#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x961F;&#x5217;&#x5927;&#x5C0F;&#xFF0C;&#x82E5;&#x5B9E;&#x9645;&#x8BF7;&#x6C42;&#x6570;&#x8D85;&#x8FC7;&#x6B64;&#x5927;&#x5C0F;&#xFF0C;&#x7F51;&#x7EDC;&#x7EBF;&#x7A0B;&#x5C06;&#x505C;&#x6B62;&#x63A5;&#x6536;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
<p>socket.send.buffer.bytes    100 * 1024    The SO_SNDBUFF buffer the server prefers for socket connections.</p>
<p>socket.receive.buffer.bytes    100 * 1024    The SO_RCVBUFF buffer the server prefers for socket connections.</p>
<p>socket.request.max.bytes    100 <em> 1024 </em> 1024    &#x670D;&#x52A1;&#x5668;&#x5141;&#x8BB8;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C; &#x7528;&#x6765;&#x9632;&#x6B62;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF0C;&#x5176;&#x503C;&#x5E94;&#x8BE5;&#x5C0F;&#x4E8E; Java heap size.</p>
<p>num.partitions    1    &#x9ED8;&#x8BA4; partition &#x6570;&#x91CF;&#xFF0C;&#x5982;&#x679C; topic &#x5728;&#x521B;&#x5EFA;&#x65F6;&#x6CA1;&#x6709;&#x6307;&#x5B9A; partition &#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x6B64;&#x503C;&#xFF0C;&#x5EFA;&#x8BAE;&#x6539;&#x4E3A; 5</p>
<p>log.segment.bytes    1024 <em> 1024 </em> 1024    Segment &#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x8D85;&#x8FC7;&#x6B64;&#x503C;&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A; segment&#xFF0C;&#x6B64;&#x503C;&#x53EF;&#x4EE5;&#x88AB; topic &#x7EA7;&#x522B;&#x7684;&#x53C2;&#x6570;&#x8986;&#x76D6;&#x3002;</p>
<p>log.roll.{ms,hours}    24 * 7 hours    &#x65B0;&#x5EFA; segment &#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x6B64;&#x503C;&#x53EF;&#x4EE5;&#x88AB; topic &#x7EA7;&#x522B;&#x7684;&#x53C2;&#x6570;&#x8986;&#x76D6;&#x3002;</p>
<p>log.retention.{ms,minutes,hours}    7 days    Kafka segment log &#x7684;&#x4FDD;&#x5B58;&#x5468;&#x671F;&#xFF0C;&#x4FDD;&#x5B58;&#x5468;&#x671F;&#x8D85;&#x8FC7;&#x6B64;&#x65F6;&#x95F4;&#x65E5;&#x5FD7;&#x5C31;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x6B64;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x88AB; topic &#x7EA7;&#x522B;&#x53C2;&#x6570;&#x8986;&#x76D6;&#x3002;&#x6570;&#x636E;&#x91CF;&#x5927;&#x65F6;&#xFF0C;&#x5EFA;&#x8BAE;&#x51CF;&#x5C0F;&#x6B64;&#x503C;&#x3002;</p>
<p>log.retention.bytes    -1    &#x6BCF;&#x4E2A; partition &#x7684;&#x6700;&#x5927;&#x5BB9;&#x91CF;&#xFF0C;&#x82E5;&#x6570;&#x636E;&#x91CF;&#x8D85;&#x8FC7;&#x6B64;&#x503C;&#xFF0C;partition &#x6570;&#x636E;&#x5C06;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x6CE8;&#x610F;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x63A7;&#x5236;&#x7684;&#x662F;&#x6BCF;&#x4E2A; partition &#x800C;&#x4E0D;&#x662F; topic&#x3002;&#x6B64;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x88AB; log &#x7EA7;&#x522B;&#x53C2;&#x6570;&#x8986;&#x76D6;&#x3002;</p>
<p>log.retention.check.interval.ms    5 minutes    &#x5220;&#x9664;&#x7B56;&#x7565;&#x7684;&#x68C0;&#x67E5;&#x5468;&#x671F;</p>
<p>auto.create.topics.enable    true    &#x81EA;&#x52A8;&#x521B;&#x5EFA; topic &#x53C2;&#x6570;&#xFF0C;&#x5EFA;&#x8BAE;&#x6B64;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A; false&#xFF0C;&#x4E25;&#x683C;&#x63A7;&#x5236; topic &#x7BA1;&#x7406;&#xFF0C;&#x9632;&#x6B62;&#x751F;&#x4EA7;&#x8005;&#x9519;&#x5199; topic&#x3002;</p>
<p>default.replication.factor    1    &#x9ED8;&#x8BA4;&#x526F;&#x672C;&#x6570;&#x91CF;&#xFF0C;&#x5EFA;&#x8BAE;&#x6539;&#x4E3A; 2&#x3002;</p>
<p>replica.lag.time.max.ms    10000    &#x5728;&#x6B64;&#x7A97;&#x53E3;&#x65F6;&#x95F4;&#x5185;&#x6CA1;&#x6709;&#x6536;&#x5230; follower &#x7684; fetch &#x8BF7;&#x6C42;&#xFF0C;leader &#x4F1A;&#x5C06;&#x5176;&#x4ECE; ISR(in-sync replicas)&#x4E2D;&#x79FB;&#x9664;&#x3002;</p>
<p>replica.lag.max.messages    4000    &#x5982;&#x679C; replica &#x8282;&#x70B9;&#x843D;&#x540E; leader &#x8282;&#x70B9;&#x6B64;&#x503C;&#x5927;&#x5C0F;&#x7684;&#x6D88;&#x606F;&#x6570;&#x91CF;&#xFF0C;leader &#x8282;&#x70B9;&#x5C31;&#x4F1A;&#x5C06;&#x5176;&#x4ECE; ISR &#x4E2D;&#x79FB;&#x9664;&#x3002;</p>
<p>replica.socket.timeout.ms    30 * 1000    replica &#x5411; leader &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<p>replica.socket.receive.buffer.bytes    64 * 1024    The socket receive buffer for network requests to the leader for replicating data.</p>
<p>replica.fetch.max.bytes    1024 * 1024    The number of byes of messages to attempt to fetch for each partition in the fetch requests the replicas send to the leader.</p>
<p>replica.fetch.wait.max.ms    500    The maximum amount of time to wait time for data to arrive on the leader in the fetch requests sent by the replicas to the leader.</p>
<p>num.replica.fetchers    1    Number of threads used to replicate messages from leaders. Increasing this value can increase the degree of I/O parallelism in the follower broker.</p>
<p>fetch.purgatory.purge.interval.requests    1000    The purge interval (in number of requests) of the fetch request purgatory.</p>
<p>zookeeper.session.timeout.ms    6000    ZooKeeper session &#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x5728;&#x6B64;&#x65F6;&#x95F4;&#x5185; server &#x6CA1;&#x6709;&#x5411; zookeeper &#x53D1;&#x9001;&#x5FC3;&#x8DF3;&#xFF0C;zookeeper &#x5C31;&#x4F1A;&#x8BA4;&#x4E3A;&#x6B64;&#x8282;&#x70B9;&#x5DF2;&#x6302;&#x6389;&#x3002; &#x6B64;&#x503C;&#x592A;&#x4F4E;&#x5BFC;&#x81F4;&#x8282;&#x70B9;&#x5BB9;&#x6613;&#x88AB;&#x6807;&#x8BB0;&#x6B7B;&#x4EA1;&#xFF1B;&#x82E5;&#x592A;&#x9AD8;&#xFF0C;.&#x4F1A;&#x5BFC;&#x81F4;&#x592A;&#x8FDF;&#x53D1;&#x73B0;&#x8282;&#x70B9;&#x6B7B;&#x4EA1;&#x3002;</p>
<p>zookeeper.connection.timeout.ms    6000    &#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5; zookeeper &#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<p>zookeeper.sync.time.ms    2000    H ZK follower &#x843D;&#x540E; ZK leader &#x7684;&#x65F6;&#x95F4;&#x3002;</p>
<p>controlled.shutdown.enable    true    &#x5141;&#x8BB8; broker shutdown&#x3002;&#x5982;&#x679C;&#x542F;&#x7528;&#xFF0C;broker &#x5728;&#x5173;&#x95ED;&#x81EA;&#x5DF1;&#x4E4B;&#x524D;&#x4F1A;&#x628A;&#x5B83;&#x4E0A;&#x9762;&#x7684;&#x6240;&#x6709; leaders &#x8F6C;&#x79FB;&#x5230;&#x5176;&#x5B83; brokers &#x4E0A;&#xFF0C;&#x5EFA;&#x8BAE;&#x542F;&#x7528;&#xFF0C;&#x589E;&#x52A0;&#x96C6;&#x7FA4;&#x7A33;&#x5B9A;&#x6027;&#x3002;</p>
<p>auto.leader.rebalance.enable    true    If this is enabled the controller will automatically try to balance leadership for partitions among the brokers by periodically returning leadership to the &#x201C;preferred&#x201D; replica for each partition if it is available.</p>
<p>leader.imbalance.per.broker.percentage    10    The percentage of leader imbalance allowed per broker. The controller will rebalance leadership if this ratio goes above the configured value per broker.</p>
<p>leader.imbalance.check.interval.seconds    300    The frequency with which to check for leader imbalance.</p>
<p>offset.metadata.max.bytes    4096    The maximum amount of metadata to allow clients to save with their offsets.</p>
<p>connections.max.idle.ms    600000    Idle connections timeout: the server socket processor threads close the connections that idle more than this.</p>
<p>num.recovery.threads.per.data.dir    1    The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.</p>
<p>unclean.leader.election.enable    true    Indicates whether to enable replicas not in the ISR set to be elected as leader as a last resort, even though doing so may result in data loss.</p>
<p>delete.topic.enable    false    &#x542F;&#x7528; deletetopic &#x53C2;&#x6570;&#xFF0C;&#x5EFA;&#x8BAE;&#x8BBE;&#x7F6E;&#x4E3A; true&#x3002;</p>
<p>offsets.topic.num.partitions    50    The number of partitions for the offset commit topic. Since changing this after deployment is currently unsupported, we recommend using a higher setting for production (e.g., 100-200).</p>
<p>offsets.topic.retention.minutes    1440    Offsets that are older than this age will be marked for deletion. The actual purge will occur when the log cleaner compacts the offsets topic.</p>
<p>offsets.retention.check.interval.ms    600000    The frequency at which the offset manager checks for stale offsets.</p>
<p>offsets.topic.replication.factor    3    The replication factor for the offset commit topic. A higher setting (e.g., three or four) is recommended in order to ensure higher availability. If the offsets topic is created when fewer brokers than the replication factor then the offsets topic will be created with fewer replicas.</p>
<p>offsets.topic.segment.bytes    104857600    Segment size for the offsets topic. Since it uses a compacted topic, this should be kept relatively low in order to facilitate faster log compaction and loads.</p>
<p>offsets.load.buffer.size    5242880    An offset load occurs when a broker becomes the offset manager for a set of consumer groups (i.e., when it becomes a leader for an offsets topic partition). This setting corresponds to the batch size (in bytes) to use when reading from the offsets segments when loading offsets into the offset manager&#x2019;s cache.</p>
<p>offsets.commit.required.acks    -1    The number of acknowledgements that are required before the offset commit can be accepted. This is similar to the producer&#x2019;s acknowledgement setting. In general, the default should not be overridden.</p>
<p>offsets.commit.timeout.ms    5000    The offset commit will be delayed until this timeout or the required number of replicas have received the offset commit. This is similar to the producer request timeout.</p>
<h3 id="732-producer-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3.2 Producer &#x914D;&#x7F6E;&#x4FE1;&#x606F;</h3>
<p>&#x5C5E;&#x6027;    &#x9ED8;&#x8BA4;&#x503C;    &#x63CF;&#x8FF0;</p>
<p>metadata.broker.list        &#x542F;&#x52A8;&#x65F6; producer &#x67E5;&#x8BE2; brokers &#x7684;&#x5217;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x96C6;&#x7FA4;&#x4E2D;&#x6240;&#x6709; brokers &#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x96C6;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x53EA;&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6; topic &#x7684;&#x5143;&#x4FE1;&#x606F;&#x7528;&#xFF0C;producer &#x4F1A;&#x4ECE;&#x5143;&#x4FE1;&#x606F;&#x4E2D;&#x6311;&#x9009;&#x5408;&#x9002;&#x7684; broker &#x5E76;&#x4E0E;&#x4E4B;&#x5EFA;&#x7ACB; socket &#x8FDE;&#x63A5;&#x3002;&#x683C;&#x5F0F;&#x662F;&#xFF1A;host1:port1,host2:port2&#x3002;</p>
<p>request.required.acks    0    &#x53C2;&#x89C1; 3.2 &#x8282;&#x4ECB;&#x7ECD;</p>
<p>request.timeout.ms    10000    Broker &#x7B49;&#x5F85; ack &#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x82E5;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x8D85;&#x8FC7;&#x6B64;&#x503C;&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x3002;</p>
<p>producer.type    sync    &#x540C;&#x6B65;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x3002;async &#x8868;&#x793A;&#x5F02;&#x6B65;&#xFF0C;sync &#x8868;&#x793A;&#x540C;&#x6B65;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6210;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x751F;&#x4EA7;&#x8005;&#x4EE5; batch &#x7684;&#x5F62;&#x5F0F; push &#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x6781;&#x5927;&#x7684;&#x63D0;&#x9AD8; broker &#x6027;&#x80FD;&#xFF0C;&#x63A8;&#x8350;&#x8BBE;&#x7F6E;&#x4E3A;&#x5F02;&#x6B65;&#x3002;</p>
<p>serializer.class    kafka.serializer.DefaultEncoder    &#x5E8F;&#x5217;&#x53F7;&#x7C7B;&#xFF0C;.&#x9ED8;&#x8BA4;&#x5E8F;&#x5217;&#x5316;&#x6210; byte[] &#x3002;</p>
<p>key.serializer.class        Key &#x7684;&#x5E8F;&#x5217;&#x5316;&#x7C7B;&#xFF0C;&#x9ED8;&#x8BA4;&#x540C;&#x4E0A;&#x3002;</p>
<p>partitioner.class    kafka.producer.DefaultPartitioner    Partition &#x7C7B;&#xFF0C;&#x9ED8;&#x8BA4;&#x5BF9; key &#x8FDB;&#x884C; hash&#x3002;</p>
<p>compression.codec    none    &#x6307;&#x5B9A; producer &#x6D88;&#x606F;&#x7684;&#x538B;&#x7F29;&#x683C;&#x5F0F;&#xFF0C;&#x53EF;&#x9009;&#x53C2;&#x6570;&#x4E3A;&#xFF1A; &#x201C;none&#x201D;, &#x201C;gzip&#x201D; and &#x201C;snappy&#x201D;&#x3002;&#x5173;&#x4E8E;&#x538B;&#x7F29;&#x53C2;&#x89C1; 4.1 &#x8282;</p>
<p>compressed.topics    null    &#x542F;&#x7528;&#x538B;&#x7F29;&#x7684; topic &#x540D;&#x79F0;&#x3002;&#x82E5;&#x4E0A;&#x9762;&#x53C2;&#x6570;&#x9009;&#x62E9;&#x4E86;&#x4E00;&#x4E2A;&#x538B;&#x7F29;&#x683C;&#x5F0F;&#xFF0C;&#x90A3;&#x4E48;&#x538B;&#x7F29;&#x4EC5;&#x5BF9;&#x672C;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x7684; topic &#x6709;&#x6548;&#xFF0C;&#x82E5;&#x672C;&#x53C2;&#x6570;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x5BF9;&#x6240;&#x6709; topic &#x6709;&#x6548;&#x3002;</p>
<p>message.send.max.retries    3    Producer &#x53D1;&#x9001;&#x5931;&#x8D25;&#x65F6;&#x91CD;&#x8BD5;&#x6B21;&#x6570;&#x3002;&#x82E5;&#x7F51;&#x7EDC;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x65AD;&#x91CD;&#x8BD5;&#x3002;</p>
<p>retry.backoff.ms    100    Before each retry, the producer refreshes the metadata of relevant topics to see if a new leader has been elected. Since leader election takes a bit of time, this property specifies the amount of time that the producer waits before refreshing the metadata.</p>
<p>topic.metadata.refresh.interval.ms    600 * 1000    The producer generally refreshes the topic metadata from brokers when there is a failure (partition missing, leader not available&#x2026;). It will also poll regularly (default: every 10min so 600000ms). If you set this to a negative value, metadata will only get refreshed on failure. If you set this to zero, the metadata will get refreshed after each message sent (not recommended). Important note: the refresh happen only AFTER the message is sent, so if the producer never sends a message the metadata is never refreshed</p>
<p>queue.buffering.max.ms    5000    &#x542F;&#x7528;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x65F6;&#xFF0C;producer &#x7F13;&#x5B58;&#x6D88;&#x606F;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#x6210; 1000 &#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x7F13;&#x5B58; 1 &#x79D2;&#x7684;&#x6570;&#x636E;&#x518D;&#x4E00;&#x6B21;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x6781;&#x5927;&#x7684;&#x589E;&#x52A0; broker &#x541E;&#x5410;&#x91CF;&#xFF0C;&#x4F46;&#x4E5F;&#x4F1A;&#x9020;&#x6210;&#x65F6;&#x6548;&#x6027;&#x7684;&#x964D;&#x4F4E;&#x3002;</p>
<p>queue.buffering.max.messages    10000    &#x91C7;&#x7528;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x65F6; producer buffer &#x961F;&#x5217;&#x91CC;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x7684;&#x6D88;&#x606F;&#x6570;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x503C;&#xFF0C;producer &#x5C31;&#x4F1A;&#x963B;&#x585E;&#x6216;&#x8005;&#x4E22;&#x6389;&#x6D88;&#x606F;&#x3002;</p>
<p>queue.enqueue.timeout.ms    -1    &#x5F53;&#x8FBE;&#x5230;&#x4E0A;&#x9762;&#x53C2;&#x6570;&#x503C;&#x65F6; producer &#x963B;&#x585E;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A; 0&#xFF0C;buffer &#x961F;&#x5217;&#x6EE1;&#x65F6; producer &#x4E0D;&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x6D88;&#x606F;&#x76F4;&#x63A5;&#x88AB;&#x4E22;&#x6389;&#x3002;&#x82E5;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A;-1&#xFF0C;producer &#x4F1A;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x4E0D;&#x4F1A;&#x4E22;&#x6D88;&#x606F;&#x3002;</p>
<p>batch.num.messages    200    &#x91C7;&#x7528;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x65F6;&#xFF0C;&#x4E00;&#x4E2A; batch &#x7F13;&#x5B58;&#x7684;&#x6D88;&#x606F;&#x6570;&#x91CF;&#x3002;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x6570;&#x91CF;&#x503C;&#x65F6; producer &#x624D;&#x4F1A;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x3002;</p>
<p>send.buffer.bytes    100 * 1024    Socket write buffer size</p>
<p>client.id    &#x201C;&#x201D;    The client id is a user-specified string sent in each request to help trace calls. It should logically identify the application making the request.</p>
<h3 id="733-consumer-&#x914D;&#x7F6E;&#x4FE1;&#x606F;">7.3.3 Consumer &#x914D;&#x7F6E;&#x4FE1;&#x606F;</h3>
<p>&#x5C5E;&#x6027;    &#x9ED8;&#x8BA4;&#x503C;    &#x63CF;&#x8FF0;</p>
<p>group.id        Consumer &#x7684;&#x7EC4; ID&#xFF0C;&#x76F8;&#x540C; goup.id &#x7684; consumer &#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x7EC4;&#x3002;</p>
<p>zookeeper.connect        Consumer &#x7684; zookeeper &#x8FDE;&#x63A5;&#x4E32;&#xFF0C;&#x8981;&#x548C; broker &#x7684;&#x914D;&#x7F6E;&#x4E00;&#x81F4;&#x3002;</p>
<p>consumer.id    null    &#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#x4F1A;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</p>
<p>socket.timeout.ms    30 * 1000    &#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684; socket &#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;&#x5B9E;&#x9645;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7531; max.fetch.wait + socket.timeout.ms &#x786E;&#x5B9A;&#x3002;</p>
<p>socket.receive.buffer.bytes    64 * 1024    The socket receive buffer for network requests.</p>
<p>fetch.message.max.bytes    1024 * 1024    &#x67E5;&#x8BE2; topic-partition &#x65F6;&#x5141;&#x8BB8;&#x7684;&#x6700;&#x5927;&#x6D88;&#x606F;&#x5927;&#x5C0F;&#x3002;consumer &#x4F1A;&#x4E3A;&#x6BCF;&#x4E2A; partition &#x7F13;&#x5B58;&#x6B64;&#x5927;&#x5C0F;&#x7684;&#x6D88;&#x606F;&#x5230;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x63A7;&#x5236; consumer &#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x3002;&#x8FD9;&#x4E2A;&#x503C;&#x5E94;&#x8BE5;&#x81F3;&#x5C11;&#x6BD4; server &#x5141;&#x8BB8;&#x7684;&#x6700;&#x5927;&#x6D88;&#x606F;&#x5927;&#x5C0F;&#x5927;&#xFF0C;&#x4EE5;&#x514D; producer &#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x5927;&#x4E8E; consumer &#x5141;&#x8BB8;&#x7684;&#x6D88;&#x606F;&#x3002;</p>
<p>num.consumer.fetchers    1    The number fetcher threads used to fetch data.</p>
<p>auto.commit.enable    true    &#x5982;&#x679C;&#x6B64;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A; true&#xFF0C;consumer &#x4F1A;&#x5468;&#x671F;&#x6027;&#x7684;&#x628A;&#x5F53;&#x524D;&#x6D88;&#x8D39;&#x7684; offset &#x503C;&#x4FDD;&#x5B58;&#x5230; zookeeper&#x3002;&#x5F53; consumer &#x5931;&#x8D25;&#x91CD;&#x542F;&#x4E4B;&#x540E;&#x5C06;&#x4F1A;&#x4F7F;&#x7528;&#x6B64;&#x503C;&#x4F5C;&#x4E3A;&#x65B0;&#x5F00;&#x59CB;&#x6D88;&#x8D39;&#x7684;&#x503C;&#x3002;</p>
<p>auto.commit.interval.ms    60 * 1000    Consumer &#x63D0;&#x4EA4; offset &#x503C;&#x5230; zookeeper &#x7684;&#x5468;&#x671F;&#x3002;</p>
<p>queued.max.message.chunks    2    &#x7528;&#x6765;&#x88AB; consumer &#x6D88;&#x8D39;&#x7684; message chunks &#x6570;&#x91CF;&#xFF0C; &#x6BCF;&#x4E2A; chunk &#x53EF;&#x4EE5;&#x7F13;&#x5B58; fetch.message.max.bytes &#x5927;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x91CF;&#x3002;</p>
<p>auto.commit.interval.ms    60 * 1000    Consumer &#x63D0;&#x4EA4; offset &#x503C;&#x5230; zookeeper &#x7684;&#x5468;&#x671F;&#x3002;</p>
<p>queued.max.message.chunks    2    &#x7528;&#x6765;&#x88AB; consumer &#x6D88;&#x8D39;&#x7684; message chunks &#x6570;&#x91CF;&#xFF0C; &#x6BCF;&#x4E2A; chunk &#x53EF;&#x4EE5;&#x7F13;&#x5B58; fetch.message.max.bytes &#x5927;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x91CF;&#x3002;</p>
<p>fetch.min.bytes    1    The minimum amount of data the server should return for a fetch request. If insufficient data is available the request will wait for that much data to accumulate before answering the request.</p>
<p>fetch.wait.max.ms    100    The maximum amount of time the server will block before answering the fetch request if there isn&#x2019;t sufficient data to immediately satisfy fetch.min.bytes.</p>
<p>rebalance.backoff.ms    2000    Backoff time between retries during rebalance.</p>
<p>refresh.leader.backoff.ms    200    Backoff time to wait before trying to determine the leader of a partition that has just lost its leader.</p>
<p>auto.offset.reset    largest    What to do when there is no initial offset in ZooKeeper or if an offset is out of range ;smallest : automatically reset the offset to the smallest offset; largest : automatically reset the offset to the largest offset;anything else: throw exception to the consumer</p>
<p>consumer.timeout.ms    -1    &#x82E5;&#x5728;&#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x6CA1;&#x6709;&#x6D88;&#x606F;&#x6D88;&#x8D39;&#xFF0C;consumer &#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</p>
<p>exclude.internal.topics    true    Whether messages from internal topics (such as offsets) should be exposed to the consumer.</p>
<p>zookeeper.session.timeout.ms    6000    ZooKeeper session timeout. If the consumer fails to heartbeat to ZooKeeper for this period of time it is considered dead and a rebalance will occur.</p>
<p>zookeeper.connection.timeout.ms    6000    The max time that the client waits while establishing a connection to zookeeper.</p>
<p>zookeeper.sync.time.ms    2000    How far a ZK follower can be behind a ZK leader</p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; ohter.com 2021 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2021-04-19 20:41:05
</span></footer>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="shell.html" class="navigation navigation-prev " aria-label="Previous page: 1.集群启动停止脚本">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../mongo/" class="navigation navigation-next " aria-label="Next page: mongo">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"2.大数据技术之Kafka","level":"1.6.6.2","depth":3,"next":{"title":"mongo","level":"1.6.7","depth":2,"path":"distributed/mongo/README.md","ref":"distributed/mongo/README.md","articles":[{"title":"1.准备数据","level":"1.6.7.1","depth":3,"path":"distributed/mongo/mongoDb-data.md","ref":"distributed/mongo/mongoDb-data.md","articles":[]},{"title":"2.快速上手","level":"1.6.7.2","depth":3,"path":"distributed/mongo/mongoDb-quick-start.md","ref":"distributed/mongo/mongoDb-quick-start.md","articles":[]},{"title":"3.企业应用","level":"1.6.7.3","depth":3,"path":"distributed/mongo/mongoDb-enterprise.md","ref":"distributed/mongo/mongoDb-enterprise.md","articles":[]}]},"previous":{"title":"1.集群启动停止脚本","level":"1.6.6.1","depth":3,"path":"distributed/kafka/shell.md","ref":"distributed/kafka/shell.md","articles":[]},"dir":"ltr"},"config":{"plugins":["chapter-fold","theme-comscore","back-to-top-button","code","tbfed-pagefooter","page-treeview","pageview-count","popup","prism","-highlight","hide-element","-lunr","-search","search-pro","page-toc-button"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy ohter.com 2021","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"collapsed":false,"copyright":"Copyright © aleen42","minHeaderCount":"1","minHeaderDeep":"1"},"chapter-fold":{},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"search-pro":{},"popup":{},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"back-to-top-button":{},"pageview-count":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"liufeihua","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"日常笔记","language":"zh-hans","gitbook":"*","description":"日常笔记"},"file":{"path":"distributed/kafka/kafka.md","mtime":"2021-04-19T12:41:05.715Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-04-20T23:28:09.222Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

